import{a as Ie,b as Ve}from"./chunk-HSUUTGKP.js";import{a as Me}from"./chunk-W6ENELZB.js";import{b as Ne}from"./chunk-TWLOV2EE.js";import{b as De}from"./chunk-AKEGUMGJ.js";import{b as Ee}from"./chunk-OXAP3N3H.js";import"./chunk-HMF6RJK6.js";import{b as Oe}from"./chunk-RVQOAWJC.js";import{a as R}from"./chunk-TVRGOZ6Z.js";import{a as je}from"./chunk-LGAXEAXJ.js";import{a as P}from"./chunk-ZGEBOACG.js";import{a as L,b as $}from"./chunk-KOIAJ6TH.js";import"./chunk-G453X5NG.js";import{d as xe,e as k,l as Te,n as we}from"./chunk-CWKDICKV.js";import{h as Ae,i as G}from"./chunk-NYQZODR7.js";import{c as Fe,d as A}from"./chunk-BBS5CLCL.js";import{c as u,e as M,f as me,g as D,i as g,j as pe,k as ge,l as fe,m as ue,n as Se,o as be,q as ve,r as N,s as he,t as _e,u as I}from"./chunk-7W2NGOAN.js";import"./chunk-FNTIPBS5.js";import"./chunk-A3HZ2PBM.js";import"./chunk-2BOM3PMI.js";import{b as Ce,d as ye}from"./chunk-RVXUJXBG.js";import{a as ce}from"./chunk-Q2HHWBKA.js";import"./chunk-4Q3JVAKG.js";import{b as de}from"./chunk-MCE4IIOZ.js";import{Ea as V,Fa as O}from"./chunk-F2X7M4DW.js";import"./chunk-WCGJ44IN.js";import{B as E,m as le,o as j,p as se}from"./chunk-J6775IRK.js";import{$ as d,$b as W,Cb as ie,Eb as te,Fb as ne,Gb as a,Hb as o,Ib as S,Jb as ae,Kb as oe,Mb as z,Rb as f,Sb as F,Ta as r,V as ee,ac as s,bc as y,cc as _,ec as Y,fa as b,fc as U,ga as v,gc as J,hb as w,hc as re,ic as K,jc as X,nb as h,r as Q,v as Z,vb as H,wb as l,wc as x}from"./chunk-VDH5VFWZ.js";import"./chunk-EQDQRRRY.js";var C=class n{url=`${ce.apiUrl}/asignacionSede`;http=d(de);findAll(){return this.http.get(this.url)}findOne(i){return this.http.get(`${this.url}/${i}`)}findAllByTrabajador(i){return this.http.get(`${this.url}/byTrabajador/${i}`)}create(i){return this.http.post(`${this.url}`,i)}multipleCreate(i){return this.http.post(`${this.url}/multiple`,i)}update(i,e){return this.http.put(`${this.url}/${i}`,e)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})};function qe(n,i){if(n&1&&(a(0,"div",11)(1,"label",12),s(2),o(),S(3,"p-datepicker",13),o()),n&2){let e=i.$implicit,t=i.index;l("formGroupName",t),r(2),_(" Fecha de asignaci\xF3n | ",e==null||e.value==null?null:e.value.nombreSede," "),r(),l("showIcon",!0)}}var T=class n{ref=d(Fe);dialogService=d(A);sedeService=d(R);asignacionSedeService=d(C);trabajadorService=d(P);listaTrabajadores=[];listaSedes=[];listaCargos=[];formData=new D({idTrabajador:new g(void 0,{nonNullable:!0,validators:[u.required]}),idSedes:new g([],{nonNullable:!0,validators:[u.required,u.minLength(1)]}),asignaciones:new ve([])});idTrabajador;get asignaciones(){return this.formData.get("asignaciones")}ngOnInit(){let e=this.dialogService.getInstance(this.ref).data;e&&(this.idTrabajador=e.idTrabajador,this.formData.get("idTrabajador")?.setValue(e.idTrabajador),this.formData.get("idTrabajador")?.disable(),this.precargar()),this.cargarSedes(),this.cargarTrabajadoresActivos()}precargar(){this.idTrabajador&&this.asignacionSedeService.findAllByTrabajador(this.idTrabajador).subscribe({next:i=>{this.formData.get("idSedes")?.setValue(i.map(e=>e.idSede)),this.asignaciones.clear(),i.forEach(e=>{let t=new D({id:new g(e.id,{nonNullable:!0,validators:[]}),idSede:new g(e.idSede,{nonNullable:!0,validators:[u.required]}),nombreSede:new g(e.sede.nombre,{nonNullable:!0,validators:[u.required]}),fechaAsignacion:new g(new Date(e.fechaAsignacion),{nonNullable:!0,validators:[u.required]})});this.asignaciones.push(t)})}})}cargarSedes(){this.sedeService.findAll(!1).subscribe({next:i=>{this.listaSedes=i}})}cargarTrabajadoresActivos(){this.trabajadorService.findAllActivos().subscribe({next:i=>{this.listaTrabajadores=i.map(e=>(e.labelName=`${e.identificacion} | ${e.apellido} ${e.nombre}`,e))}})}selectTrabajador(i){this.idTrabajador=i,this.precargar()}selectSedes(i){if(!i||i.length===0){this.asignaciones.clear();return}this.asignaciones.controls.forEach(e=>{let t=e.get("idSede")?.value;i.includes(t)||this.asignaciones.removeAt(this.asignaciones.controls.indexOf(e))}),i.forEach(e=>{let t=this.listaSedes.find(q=>q.id===e);if(!t)return;let{id:m,nombre:p}=t;if(this.asignaciones.controls.find(q=>q.get("idSede")?.value===e))return;let B=new D({id:new g(void 0,{nonNullable:!0,validators:[]}),idSede:new g(m,{nonNullable:!0,validators:[u.required]}),nombreSede:new g(p,{nonNullable:!0,validators:[u.required]}),fechaAsignacion:new g(void 0,{nonNullable:!0,validators:[u.required]})});this.asignaciones.push(B)})}onUpload(i){console.log(i.files)}guardar(){let i=this.formData.get("idTrabajador")?.value,e=this.formData.get("asignaciones")?.value??[];this.asignacionSedeService.multipleCreate(e.map(t=>({id:t.id??void 0,idSede:t.idSede,idTrabajador:i,fechaAsignacion:t.fechaAsignacion}))).subscribe({next:t=>{this.ref.close(t)}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=w({type:n,selectors:[["app-form-asignacion-sede"]],decls:18,vars:7,consts:[[1,"flex","flex-col","gap-2"],[1,"grid","grid-cols-1","gap-2",3,"formGroup"],["for","idTrabajadorAsignacion",1,"text-sm","font-medium"],[1,"text-xs"],["id","idTrabajadorAsignacion","optionLabel","labelName","optionValue","id","formControlName","idTrabajador","placeholder","Seleccione...","appendTo","body",3,"onChange","options"],["for","idSedeAsignacion",1,"text-sm","font-medium"],["optionLabel","nombre","optionValue","id","formControlName","idSedes","placeholder","Seleccione...","appendTo","body",3,"onChange","options","maxSelectedLabels"],["formArrayName","asignaciones",1,"grid","grid-cols-1","gap-2"],["class","flex flex-col gap-2",3,"formGroupName",4,"ngFor","ngForOf"],[1,"flex","justify-end","gap-2","mt-4"],["severity","info","size","small",3,"onClick","label","disabled"],[1,"flex","flex-col","gap-2",3,"formGroupName"],["for","fechaAsignacion",1,"text-sm","font-medium"],["id","fechaAsignacion","styleClass","w-full uppercase","dateFormat","dd M yy","placeholder","DD MMM YYYY","formControlName","fechaAsignacion","appendTo","body",3,"showIcon"]],template:function(e,t){e&1&&(a(0,"div",0)(1,"form",1)(2,"div",0)(3,"label",2),s(4," Trabajador "),a(5,"span",3),s(6,"*"),o()(),a(7,"p-select",4),f("onChange",function(p){return t.selectTrabajador(p.value)}),o()(),a(8,"div",0)(9,"label",5),s(10," Edificios "),a(11,"span",3),s(12,"*"),o()(),a(13,"p-multiselect",6),f("onChange",function(p){return t.selectSedes(p.value)}),o()(),a(14,"div",7),h(15,qe,4,3,"div",8),o()(),a(16,"div",9)(17,"p-button",10),f("onClick",function(){return t.guardar()}),o()()()),e&2&&(r(),l("formGroup",t.formData),r(6),l("options",t.listaTrabajadores),r(6),l("options",t.listaSedes)("maxSelectedLabels",2),r(2),l("ngForOf",t.asignaciones.controls),r(2),l("label","Asignar")("disabled",t.formData.invalid))},dependencies:[E,j,N,ge,M,me,he,fe,be,ue,Se,Ee,I,O,V,$,L,G,Ae,k,xe,De,Ne],encapsulation:2})};var He=()=>["nombre","apellido"],ze=n=>[n],We=n=>["text-xs uppercase",n],Ye=()=>[];function Ue(n,i){if(n&1&&(a(0,"th",25)(1,"div",25),s(2),o()()),n&2){let e=i.$implicit;l("ngClass",X(3,ze,e.widthClass?e.widthClass:"")),r(),l("ngClass",X(5,We,e.align?"text-"+e.align:"text-start")),r(),_(" ",e.header," ")}}function Je(n,i){if(n&1&&(a(0,"tr"),h(1,Ue,3,7,"th",24),o()),n&2){let e=i.$implicit;r(),l("ngForOf",e)}}function Ke(n,i){if(n&1&&(a(0,"li"),s(1),o()),n&2){let e=i.$implicit;r(),_(" ",e.sede==null?null:e.sede.nombre," ")}}function Xe(n,i){if(n&1){let e=z();a(0,"tr")(1,"td")(2,"div",26),s(3),o()(),a(4,"td")(5,"div",27),s(6),o()(),a(7,"td")(8,"div",27),s(9),o()(),a(10,"td")(11,"div",26),s(12),o()(),a(13,"td")(14,"div",27)(15,"ul",28),h(16,Ke,2,1,"li",29),o()()(),a(17,"td")(18,"div",30)(19,"p-button",31),f("click",function(){let m=b(e).$implicit,p=F();return v(p.editar(m.id))}),S(20,"i",32),o()()()()}if(n&2){let e=i.$implicit;r(3),y(e.orden),r(3),y(e.nombre),r(3),y(e.apellido),r(3),_(" ",e.contratos[0]==null||e.contratos[0].cargo==null?null:e.contratos[0].cargo.nombre," "),r(4),l("ngForOf",e.asignacionSedes),r(4),H("data-icon","solar:pen-new-square-linear")}}function Qe(n,i){n&1&&(a(0,"td"),S(1,"p-skeleton"),o())}function Ze(n,i){if(n&1&&(a(0,"tr",34),h(1,Qe,2,0,"td",29),o()),n&2){let e=F(3);r(),l("ngForOf",e.cols)}}function ei(n,i){n&1&&(ae(0),te(1,Ze,2,1,"tr",34,ie),oe()),n&2&&(r(),ne(K(0,Ye).constructor(4)))}function ii(n,i){n&1&&(a(0,"tr")(1,"td",35)(2,"div",36),s(3," No se encontraron registros. "),o()()())}function ti(n,i){if(n&1&&h(0,ei,3,1,"ng-container",33)(1,ii,4,0,"ng-template",null,4,x),n&2){let e=W(2),t=F();l("ngIf",t.loadingTable)("ngIfElse",e)}}var Ge=class n{title="Asignaci\xF3n de edificio";icon="material-symbols:person-pin-outline-rounded";ref;dialogService=d(A);cargoService=d(je);sedeService=d(R);asignacionSedeService=d(C);msg=d(Me);trabajadorService=d(P);fechaSelected=new Date("2025/03/01");selectedSedes=[];selectedCargos=[];listaTrabajadores=[];dataTable=[];listaCargos=[];listaSedes=[];cols;exportColumns;loadingTable=!1;ngOnInit(){this.cols=[{field:"id",header:"ID",customExportHeader:"Asignaci\xF3n ID",align:"center",widthClass:"!w-20"},{field:"nombre",header:"Nombre"},{field:"apellido",header:"Apellido"},{field:"cargo",header:"Cargo",align:"center"},{field:"sede",header:"Edificio",align:"center"},{field:"",header:"Acciones",align:"center",widthClass:"!w-36"}],this.exportColumns=this.cols.filter(i=>i.field!="").map(i=>({title:i.header,dataKey:i.field})),this.cargarTrabajadoresActivos()}cargarTrabajadoresActivos(){this.loadingTable=!0,Z([this.sedeService.findAll(),this.cargoService.findAll()]).pipe(Q(i=>(this.listaSedes=i[0],this.selectedSedes=this.listaSedes.map(e=>e.id),this.listaCargos=i[1],this.selectedCargos=this.listaCargos.map(e=>e.id),this.trabajadorService.findAllActivos()))).subscribe({next:i=>{this.listaTrabajadores=i,this.dataTable=this.listaTrabajadores.filter(e=>e.asignacionSedes[0]?.idSede),this.loadingTable=!1}})}filtrar(i){this.dataTable=this.listaTrabajadores.filter(e=>this.selectedSedes.includes(e.asignacionSedes[0]?.idSede)&&this.selectedCargos.includes(e.contratos[0]?.idCargo))}addNew(){this.dialogService.open(T,{header:"Asignaci\xF3n edificio",styleClass:"modal-md",modal:!0,dismissableMask:!0,closable:!0}).onClose.subscribe(e=>{e&&this.cargarTrabajadoresActivos()})}editar(i){this.dialogService.open(T,{header:"Asignaci\xF3n edificio",styleClass:"modal-md",modal:!0,dismissableMask:!0,closable:!0,data:{idTrabajador:i}}).onClose.subscribe(t=>{t&&this.cargarTrabajadoresActivos()})}filterGlobal(i,e){i.filterGlobal(e.value,"contains")}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=w({type:n,selectors:[["app-asignacion-sede"]],features:[re([A])],decls:34,vars:14,consts:[["dt1",""],["header",""],["body",""],["emptymessage",""],["elseTemplate",""],[1,"flex","flex-col","h-full"],[1,"flex","flex-col","justify-center","gap-4","px-6","py-4","h-[8.5rem]"],[1,"flex","justify-between","items-center","gap-4"],[1,"flex","items-center","gap-4"],["data-inline","false",1,"iconify","icon","font-bold","text-4xl"],[1,"text-2xl","font-semibold"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],["optionLabel","nombre","optionValue","id","placeholder","Edificios","styleClass","w-42","pTooltip","Edificios","tooltipPosition","top","tooltipStyleClass","text-sm",3,"ngModelChange","onChange","options","ngModel","maxSelectedLabels"],["optionLabel","nombre","optionValue","id","placeholder","Cargos","styleClass","w-42","pTooltip","Cargos","tooltipPosition","top","tooltipStyleClass","text-sm",3,"ngModelChange","onChange","options","ngModel","maxSelectedLabels"],["styleClass","pi pi-search"],["type","text","pInputText","","placeholder","Buscar",3,"input"],["severity","info","size","small"],[1,"flex","justify-center","items-center","font-medium","gap-1"],["data-icon","material-symbols:download-rounded","data-inline","false",1,"iconify","icon","text-lg"],["severity","info","size","small",3,"click"],["data-icon","material-symbols:add-rounded","data-inline","false",1,"iconify","icon","text-lg"],[1,"flex","flex-col","h-[calc(100%","-","8.5rem)]","px-6"],["stripedRows","","scrollHeight","720px","styleClass","w-full","exportFilename","asignacionSedes",3,"columns","value","scrollable","exportHeader","globalFilterFields"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"text-center","text-sm"],[1,"text-start","text-sm"],[1,"list-disc","ps-6"],[4,"ngFor","ngForOf"],[1,"flex","justify-center","items-center","gap-2"],["text","","severity","success","size","small","rounded","","styleClass","!w-10 !p-2","pTooltip","Editar","tooltipPosition","top","tooltipStyleClass","!text-xs !font-normal !p-0",3,"click"],["data-inline","false",1,"iconify","icon","font-bold","text-xl"],[4,"ngIf","ngIfElse"],[1,"h-12"],["colspan","100"],[1,"text-center","text-sm","font-extralight"]],template:function(e,t){if(e&1){let m=z();a(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8),S(4,"i",9),a(5,"h2",10),s(6),o()()(),a(7,"div",11)(8,"div",12)(9,"p-multiselect",13),J("ngModelChange",function(c){return b(m),U(t.selectedSedes,c)||(t.selectedSedes=c),v(c)}),f("onChange",function(c){return b(m),v(t.filtrar(c.value))}),o(),a(10,"p-multiselect",14),J("ngModelChange",function(c){return b(m),U(t.selectedCargos,c)||(t.selectedCargos=c),v(c)}),f("onChange",function(c){return b(m),v(t.filtrar(c.value))}),o(),a(11,"p-iconfield"),S(12,"p-inputicon",15),a(13,"input",16),f("input",function(c){b(m);let B=W(27);return v(t.filterGlobal(B,c.target))}),o()()(),a(14,"div",12)(15,"p-button",17)(16,"div",18),S(17,"i",19),a(18,"div"),s(19,"XLS"),o()()(),a(20,"p-button",20),f("click",function(){return b(m),v(t.addNew())}),a(21,"div",18),S(22,"i",21),a(23,"div"),s(24,"ASIGNAR EDIFICIO"),o()()()()()(),a(25,"div",22)(26,"p-table",23,0),h(28,Je,2,1,"ng-template",null,1,x)(30,Xe,21,6,"ng-template",null,2,x)(32,ti,3,2,"ng-template",null,3,x),o()()()}e&2&&(r(4),H("data-icon",t.icon),r(2),y(t.title),r(3),l("options",t.listaSedes),Y("ngModel",t.selectedSedes),l("maxSelectedLabels",2),r(),l("options",t.listaCargos),Y("ngModel",t.selectedCargos),l("maxSelectedLabels",2),r(16),l("columns",t.cols)("value",t.dataTable)("scrollable",!0)("exportHeader","customExportHeader")("globalFilterFields",K(13,He)))},dependencies:[E,le,j,se,N,M,pe,$,L,O,V,we,Te,ye,Ce,I,_e,G,k,Ve,Ie,Oe],encapsulation:2})};export{Ge as AsignacionSedeComponent};
