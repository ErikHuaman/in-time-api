import{a as Oe}from"./chunk-7BWTKBU3.js";import{a as Ae,b as Be}from"./chunk-HSUUTGKP.js";import{a as Pe}from"./chunk-W6ENELZB.js";import{a as Ge,b as Je}from"./chunk-AKEGUMGJ.js";import{b as Ne}from"./chunk-OXAP3N3H.js";import{a as Re}from"./chunk-WA5IO6KH.js";import{a as Le,b as He}from"./chunk-RVQOAWJC.js";import{a as We}from"./chunk-TVRGOZ6Z.js";import{a as ke}from"./chunk-LGAXEAXJ.js";import{a as je,b as Ve}from"./chunk-KOIAJ6TH.js";import"./chunk-G453X5NG.js";import{d as L,e as H,l as Fe,n as Ee}from"./chunk-CWKDICKV.js";import{c as Me,d as Te,i as R}from"./chunk-NYQZODR7.js";import{c as De,d as E}from"./chunk-BBS5CLCL.js";import{b as _e,c as F,e as k,f as be,g as ye,i as S,j as N,k as Ce,l as ve,o as Se,r as O,s as Ie,t as P,u as W}from"./chunk-7W2NGOAN.js";import"./chunk-FNTIPBS5.js";import"./chunk-A3HZ2PBM.js";import"./chunk-2BOM3PMI.js";import{b as xe,d as we,f as A,g as B}from"./chunk-RVXUJXBG.js";import{a as he}from"./chunk-Q2HHWBKA.js";import"./chunk-4Q3JVAKG.js";import{b as ge}from"./chunk-MCE4IIOZ.js";import{Ea as G,Fa as J}from"./chunk-F2X7M4DW.js";import"./chunk-WCGJ44IN.js";import{B as V,m as de,o as me,p as pe,v as fe,w as ue}from"./chunk-J6775IRK.js";import{$ as u,$b as w,Cb as ie,Eb as ne,Fb as ae,Gb as n,Hb as o,Ib as g,Jb as oe,Kb as re,Mb as x,Rb as h,Sb as j,Ta as l,V as te,ac as c,bc as v,cc as M,ec as _,fa as m,fc as b,ga as p,gc as y,hb as D,hc as le,ic as C,jc as Q,nb as I,r as $,sc as Z,tc as se,uc as ce,v as ee,vb as X,wb as s,wc as T}from"./chunk-VDH5VFWZ.js";import{a as K,b as U}from"./chunk-EQDQRRRY.js";var z=class r{url=`${he.apiUrl}/justificacionInasistencia`;http=u(ge);findAll(){return this.http.get(this.url)}findOne(i){return this.http.get(`${this.url}/${i}`)}create(i){let e=Oe(i);return this.http.post(`${this.url}`,e)}update(i,e){return this.http.put(`${this.url}/${i}`,e)}static \u0275fac=function(e){return new(e||r)};static \u0275prov=te({token:r,factory:r.\u0275fac,providedIn:"root"})};var q=()=>({standalone:!0}),Y=class r{ref=u(De);dialogService=u(E);msg=u(Pe);justificacionInasistenciaService=u(z);trabajador;sede;cargo;fecha;formData=new ye({idTrabajador:new S(void 0,{nonNullable:!0,validators:[F.required]}),idHorarioTrabajador:new S(void 0,{nonNullable:!0,validators:[F.required]}),idHorarioTrabajadorItem:new S(void 0,{nonNullable:!0,validators:[F.required]}),nota:new S(void 0,{nonNullable:!0,validators:[F.required]}),conGoce:new S(!1,{nonNullable:!0,validators:[]}),incluirExtra:new S({value:!1,disabled:!0},{nonNullable:!0,validators:[]})});id;archivo;filename;ngOnInit(){let e=this.dialogService.getInstance(this.ref).data;e&&(this.id=e?.justificacion?.id,this.trabajador=`${e?.trabajador?.identificacion} | ${e?.trabajador?.nombre}`,this.cargo=e?.cargo?.nombre,this.sede=e?.sede?.nombre,console.log("data",e),this.formData.get("idTrabajador")?.setValue(e?.trabajador?.id),this.formData.get("idHorarioTrabajador")?.setValue(e?.idHorarioTrabajador),this.formData.get("idHorarioTrabajadorItem")?.setValue(e?.idHorarioTrabajadorItem),this.fecha=new Date(e?.fecha),this.formData.get("nota")?.setValue(e?.justificacion?.nota),this.formData.get("conGoce")?.setValue(e?.justificacion?.conGoce),this.formData.get("incluirExtra")?.setValue(e?.justificacion?.incluirExtra))}get conGoce(){return!!this.formData.get("conGoce")?.value}onFileSelected(i){let e=i.target.files[0];e&&e.type==="application/pdf"?(this.msg.info("Archivo cargado"),this.archivo=e,this.filename=this.archivo.name):(this.msg.error("Archivo inv\xE1lido. Solo se permiten archivos PDF."),i.target.value="",this.archivo=void 0,this.filename="")}guardar(){let i=this.formData.value;this.id?this.justificacionInasistenciaService.update(this.id,U(K({},i),{fecha:this.fecha})).subscribe({next:e=>{this.msg.success("\xA1Actualizado con \xE9xito!"),this.ref.close(e)},error:e=>{this.msg.error(e.error.message)}}):this.justificacionInasistenciaService.create(U(K({},i),{fecha:this.fecha,archivo:this.archivo})).subscribe({next:e=>{this.msg.success("\xA1Registrado con \xE9xito!"),this.ref.close(e)},error:e=>{this.msg.error(e.error.message)}})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=D({type:r,selectors:[["app-form-inasistencia"]],decls:45,vars:20,consts:[["fileImage",""],[1,"flex","flex-col","gap-2"],[1,"grid","grid-cols-1","gap-2",3,"formGroup"],["for","username",1,"text-sm","font-medium"],["pInputText","","id","nombre","readonly","","disabled","",3,"ngModelChange","ngModel","ngModelOptions"],["for","fechaInicio",1,"text-sm","font-medium"],["id","fechaInicio","styleClass","w-full uppercase","dateFormat","dd M yy","placeholder","DD MMM YYYY","appendTo","body","disabled","",3,"ngModelChange","ngModel","readonlyInput","showIcon","ngModelOptions"],["formControlName","nota","rows","3","cols","30","pTextarea",""],[1,"flex"],["type","file","accept","application/pdf",1,"hidden",3,"change"],[1,"flex","items-center","gap-2"],["severity","contrast","size","small",3,"click"],[1,"flex","justify-center","items-center"],[1,"w-64","text-sm","italic","truncate",3,"pTooltip"],["formControlName","conGoce","binary","true"],["for","conGoce",1,"text-sm","pt-1"],["formControlName","incluirExtra","binary","true",3,"disabled"],["for","incluirExtra",1,"text-sm","pt-1"],[1,"flex","justify-end","gap-2","mt-4"],["severity","info","size","small",3,"onClick","label","disabled"]],template:function(e,t){if(e&1){let d=x();n(0,"div",1)(1,"form",2)(2,"div",1)(3,"label",3),c(4,"Edificio"),o(),n(5,"input",4),y("ngModelChange",function(a){return m(d),b(t.sede,a)||(t.sede=a),p(a)}),o()(),n(6,"div",1)(7,"label",3),c(8,"Cargo"),o(),n(9,"input",4),y("ngModelChange",function(a){return m(d),b(t.cargo,a)||(t.cargo=a),p(a)}),o()(),n(10,"div",1)(11,"label",3),c(12,"Trabajador"),o(),n(13,"input",4),y("ngModelChange",function(a){return m(d),b(t.trabajador,a)||(t.trabajador=a),p(a)}),o()(),n(14,"div",1)(15,"label",5),c(16," Fecha de inasistencia "),o(),n(17,"p-datepicker",6),y("ngModelChange",function(a){return m(d),b(t.fecha,a)||(t.fecha=a),p(a)}),o()(),n(18,"div",1)(19,"label",3),c(20,"Nota"),o(),g(21,"textarea",7),o(),n(22,"div",1)(23,"label",3),c(24,"Archivo adjunto "),o(),n(25,"div",8)(26,"input",9,0),h("change",function(a){return m(d),p(t.onFileSelected(a))}),o(),n(28,"div",10)(29,"p-button",11),h("click",function(){m(d);let a=w(27);return p(a.click())}),n(30,"div",12)(31,"div"),c(32,"Cargar"),o()()(),n(33,"p",13),c(34),o()()()(),n(35,"div",10),g(36,"p-checkbox",14),n(37,"label",15),c(38," Justificaci\xF3n con goce de haber "),o()(),n(39,"div",10),g(40,"p-checkbox",16),n(41,"label",17),c(42," Incluir pago de horas extra "),o()()(),n(43,"div",18)(44,"p-button",19),h("onClick",function(){return m(d),p(t.guardar())}),o()()()}e&2&&(l(),s("formGroup",t.formData),l(4),_("ngModel",t.sede),s("ngModelOptions",C(16,q)),l(4),_("ngModel",t.cargo),s("ngModelOptions",C(17,q)),l(4),_("ngModel",t.trabajador),s("ngModelOptions",C(18,q)),l(4),_("ngModel",t.fecha),s("readonlyInput",!0)("showIcon",!0)("ngModelOptions",C(19,q)),l(16),s("pTooltip",t.filename),l(),M(" ",t.filename?t.filename:"Archivo no cargado."," "),l(6),s("disabled",!t.conGoce),l(4),s("label",t.id?"Actualizar":"Guardar")("disabled",t.formData.invalid||!t.archivo))},dependencies:[V,O,Ce,_e,k,be,N,Ie,ve,Se,Ne,W,P,J,G,R,H,L,Je,Ge,Te,Me,B,A],encapsulation:2})};var et=()=>["nombre","apellido"],tt=r=>[r],it=r=>["text-xs uppercase",r],nt=()=>[];function at(r,i){if(r&1&&(n(0,"th",24)(1,"div",24),c(2),o()()),r&2){let e=i.$implicit;s("ngClass",Q(3,tt,e.widthClass?e.widthClass:"")),l(),s("ngClass",Q(5,it,e.align?"text-"+e.align:"text-start")),l(),M(" ",e.header," ")}}function ot(r,i){if(r&1&&(n(0,"tr"),I(1,at,3,7,"th",23),o()),r&2){let e=i.$implicit;l(),s("ngForOf",e)}}function rt(r,i){if(r&1){let e=x();n(0,"tr")(1,"td")(2,"div",25),c(3),Z(4,"date"),Z(5,"uppercase"),o()(),n(6,"td"),c(7),o(),n(8,"td"),c(9),o(),n(10,"td"),c(11),o(),n(12,"td"),c(13),o(),n(14,"td"),c(15),o(),n(16,"td")(17,"div",26),g(18,"p-tag",27),o()(),n(19,"td")(20,"div",28)(21,"p-button",29),h("click",function(){let d=m(e).$implicit,f=j();return p(f.edit(d))}),g(22,"i",30),o()()()()}if(r&2){let e=i.$implicit;l(3),M(" ",se(5,12,ce(4,9,e.fecha,"dd MMM yyyy"))," "),l(4),v(e.trabajador.nombre),l(2),v(e.trabajador.apellido),l(2),v(e.sede.nombre),l(2),v(e.cargo.nombre),l(2),v(e.justificacion==null?null:e.justificacion.nota),l(3),s("value",e.justificacion?"Justificado":"No justificado")("severity",e.justificacion?"success":"warn"),l(4),X("data-icon","material-symbols:document-search-outline-rounded")}}function lt(r,i){r&1&&(n(0,"td"),g(1,"p-skeleton"),o())}function st(r,i){if(r&1&&(n(0,"tr",32),I(1,lt,2,0,"td",33),o()),r&2){let e=j(3);l(),s("ngForOf",e.cols)}}function ct(r,i){r&1&&(oe(0),ne(1,st,2,1,"tr",32,ie),re()),r&2&&(l(),ae(C(0,nt).constructor(4)))}function dt(r,i){r&1&&(n(0,"tr")(1,"td",34)(2,"div",35),c(3," No se encontraron registros. "),o()()())}function mt(r,i){if(r&1&&I(0,ct,3,1,"ng-container",31)(1,dt,4,0,"ng-template",null,4,T),r&2){let e=w(2),t=j();s("ngIf",t.loadingTable)("ngIfElse",e)}}var qe=class r{title="Inasistencia";icon="material-symbols:person-pin-outline-rounded";ref;dialogService=u(E);sedeService=u(We);cargoService=u(ke);asistenciaService=u(Re);fechaSelected;listaSedes=[];selectedSedes=[];listaCargos=[];selectedCargos=[];dataTable=[];cols;exportColumns;loadingTable=!1;listaAsistenciaMensual=[];ngOnInit(){this.fechaSelected=new Date("2025/04/01"),this.cols=[{field:"fecha",header:"Fecha",align:"center",widthClass:"!w-36"},{field:"nombre",header:"nombre"},{field:"apellido",header:"apellido"},{field:"sede",header:"sede"},{field:"cargo",header:"cargo"},{field:"nota",header:"Nota"},{field:"isActive",header:"Estado",align:"center",widthClass:"!w-40"},{field:"",header:"Acciones",align:"center",widthClass:"!w-28"}],this.exportColumns=this.cols.filter(i=>i.field!="").map(i=>({title:i.header,dataKey:i.field})),this.cargarInasistencia()}filtrar(i){this.dataTable=this.listaAsistenciaMensual.filter(e=>this.selectedSedes.includes(e.sede.id)&&this.selectedCargos.includes(e.cargo.id))}cambiarFecha(i){this.cargarInasistencia()}cargarInasistencia(){this.loadingTable=!0,ee([this.sedeService.findAll(),this.cargoService.findAll()]).pipe($(i=>(this.listaSedes=i[0],this.selectedSedes=this.listaSedes.map(e=>e.id),this.listaCargos=i[1],this.selectedCargos=this.listaCargos.map(e=>e.id),this.asistenciaService.findAllInasistenciaByMonth(this.fechaSelected)))).subscribe({next:i=>{this.loadingTable=!1,this.listaAsistenciaMensual=i,this.filtrar()}})}edit(i){this.dialogService.open(Y,{header:"Justificaci\xF3n de inasistencia",styleClass:"modal-md",data:i,modal:!0,dismissableMask:!0,focusOnShow:!1,closable:!0}).onClose.subscribe(t=>{t&&this.cargarInasistencia()})}filterGlobal(i,e){i.filterGlobal(e.value,"contains")}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=D({type:r,selectors:[["app-inasistencia"]],features:[le([E])],decls:30,vars:16,consts:[["dt1",""],["header",""],["body",""],["emptymessage",""],["elseTemplate",""],[1,"flex","flex-col","h-full"],[1,"flex","flex-col","justify-center","gap-4","px-6","py-4","h-[8.5rem]"],[1,"flex","justify-between","items-center","gap-4"],[1,"flex","items-center","gap-4"],["data-inline","false",1,"iconify","icon","font-bold","text-4xl"],[1,"text-2xl","font-semibold"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],["id","fechaInicio","view","month","dateFormat","MM yy","placeholder","Seleccionar mes","showIcon","","iconDisplay","input","styleClass","w-44","appendTo","body","pTooltip","Mes","tooltipPosition","top","tooltipStyleClass","text-sm",3,"ngModelChange","ngModel","readonlyInput"],["optionLabel","nombre","optionValue","id","placeholder","Edificios","styleClass","w-42","pTooltip","Edificios","tooltipPosition","top","tooltipStyleClass","text-sm",3,"ngModelChange","onChange","options","ngModel","maxSelectedLabels"],["optionLabel","nombre","optionValue","id","placeholder","Cargos","styleClass","w-42","pTooltip","Cargos","tooltipPosition","top","tooltipStyleClass","text-sm",3,"ngModelChange","onChange","options","ngModel","maxSelectedLabels"],["styleClass","pi pi-search"],["type","text","pInputText","","placeholder","Buscar",3,"input"],["severity","info","size","small"],[1,"flex","justify-center","items-center","font-medium","gap-1"],["data-icon","material-symbols:download-rounded","data-inline","false",1,"iconify","icon","text-lg"],[1,"flex","flex-col","h-[calc(100%","-","8.5rem)]","px-6"],["dataKey","id","stripedRows","","scrollHeight","720px","styleClass","w-full","exportFilename","inasistencias",3,"value","scrollable","globalFilterFields","columns","exportHeader"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"text-center","text-sm"],[1,"flex","justify-center","text-sm"],["styleClass","uppercase !text-xs",3,"value","severity"],[1,"flex","justify-center"],["text","","severity","info","rounded","","pTooltip","Justificar inasistencia","tooltipPosition","top","tooltipStyleClass","!text-xs",3,"click"],["data-inline","false",1,"iconify","icon","font-bold","text-xl"],[4,"ngIf","ngIfElse"],[1,"h-12"],[4,"ngFor","ngForOf"],["colspan","100"],[1,"text-center","text-sm","font-extralight"]],template:function(e,t){if(e&1){let d=x();n(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8),g(4,"i",9),n(5,"h2",10),c(6),o()()(),n(7,"div",11)(8,"div",12)(9,"p-datepicker",13),y("ngModelChange",function(a){return m(d),b(t.fechaSelected,a)||(t.fechaSelected=a),p(a)}),h("ngModelChange",function(a){return m(d),p(t.cambiarFecha(a))}),o(),n(10,"p-multiselect",14),y("ngModelChange",function(a){return m(d),b(t.selectedSedes,a)||(t.selectedSedes=a),p(a)}),h("onChange",function(a){return m(d),p(t.filtrar(a.value))}),o(),n(11,"p-multiselect",15),y("ngModelChange",function(a){return m(d),b(t.selectedCargos,a)||(t.selectedCargos=a),p(a)}),h("onChange",function(a){return m(d),p(t.filtrar(a.value))}),o(),n(12,"p-iconfield"),g(13,"p-inputicon",16),n(14,"input",17),h("input",function(a){m(d);let Ye=w(23);return p(t.filterGlobal(Ye,a.target))}),o()()(),n(15,"div",12)(16,"p-button",18)(17,"div",19),g(18,"i",20),n(19,"div"),c(20,"XLS"),o()()()()()(),n(21,"div",21)(22,"p-table",22,0),I(24,ot,2,1,"ng-template",null,1,T)(26,rt,23,14,"ng-template",null,2,T)(28,mt,3,2,"ng-template",null,3,T),o()()()}e&2&&(l(4),X("data-icon",t.icon),l(2),v(t.title),l(3),_("ngModel",t.fechaSelected),s("readonlyInput",!0),l(),s("options",t.listaSedes),_("ngModel",t.selectedSedes),s("maxSelectedLabels",2),l(),s("options",t.listaCargos),_("ngModel",t.selectedCargos),s("maxSelectedLabels",2),l(11),s("value",t.dataTable)("scrollable",!0)("globalFilterFields",C(15,et))("columns",t.cols)("exportHeader","customExportHeader"))},dependencies:[V,de,me,pe,fe,ue,O,k,N,Ve,je,J,G,Ee,Fe,we,xe,W,P,R,He,Le,H,L,B,A,Be,Ae],encapsulation:2})};export{qe as InasistenciaComponent};
