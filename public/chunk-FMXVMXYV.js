import{a as Oe,b as Le}from"./chunk-HSUUTGKP.js";import{a as ke}from"./chunk-W6ENELZB.js";import{a as ze,b as Ae}from"./chunk-TWLOV2EE.js";import{b as Ue}from"./chunk-AKEGUMGJ.js";import{b as Ne}from"./chunk-OXAP3N3H.js";import"./chunk-HMF6RJK6.js";import{b as Pe}from"./chunk-RVQOAWJC.js";import{a as Y}from"./chunk-TVRGOZ6Z.js";import{a as R}from"./chunk-LGAXEAXJ.js";import{a as W}from"./chunk-ZGEBOACG.js";import{a as Ee,b as je}from"./chunk-KOIAJ6TH.js";import"./chunk-G453X5NG.js";import{d as P,e as B,l as Me,n as Fe}from"./chunk-CWKDICKV.js";import{h as we,i as G}from"./chunk-NYQZODR7.js";import{c as Ie,d as T}from"./chunk-BBS5CLCL.js";import{b as ge,c as b,e as k,f as he,g as be,i as v,j as ve,k as Ce,l as _e,o as Se,r as U,s as ye,t as z,u as A}from"./chunk-7W2NGOAN.js";import"./chunk-FNTIPBS5.js";import"./chunk-A3HZ2PBM.js";import"./chunk-2BOM3PMI.js";import{b as xe,d as Ve,f as De,g as Te}from"./chunk-RVXUJXBG.js";import{a as ue}from"./chunk-Q2HHWBKA.js";import"./chunk-4Q3JVAKG.js";import{b as fe}from"./chunk-MCE4IIOZ.js";import{Ea as O,Fa as L}from"./chunk-F2X7M4DW.js";import"./chunk-WCGJ44IN.js";import{B as N,m as se,o as de,p as ce,v as me,w as pe}from"./chunk-J6775IRK.js";import{$ as p,$b as K,Cb as ie,Eb as ae,Fb as oe,Gb as a,Hb as o,Ib as h,Jb as ne,Kb as re,Mb as x,Rb as g,Sb as F,Ta as r,V as ee,ac as s,bc as C,cc as _,ec as I,fa as f,fc as E,ga as u,gc as j,hb as M,hc as le,ic as X,jc as J,nb as y,r as $,sc as V,tc as Q,uc as Z,vb as te,wb as d,wc as D}from"./chunk-VDH5VFWZ.js";import{a as q,b as H}from"./chunk-EQDQRRRY.js";var S=class n{url=`${ue.apiUrl}/vacaciones`;http=p(fe);findAll(){return this.http.get(this.url)}findOne(t){return this.http.get(`${this.url}/${t}`)}create(t){return this.http.post(`${this.url}`,t)}update(t,e){return this.http.put(`${this.url}/${t}`,e)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})};var w=class n{ref=p(Ie);dialogService=p(T);cargoService=p(R);sedeService=p(Y);trabajadorService=p(W);vacacionService=p(S);msg=p(ke);listaTrabajadores=[];listaTrabajadoresFiltrados=[];listaSedes=[];listaCargos=[];formData=new be({idSede:new v(void 0,{nonNullable:!0,validators:[b.required]}),idCargo:new v(void 0,{nonNullable:!0,validators:[b.required]}),idTrabajador:new v(void 0,{nonNullable:!0,validators:[b.required]}),diasDisponibles:new v(15,{nonNullable:!0,validators:[b.required]}),diasUtilizados:new v(15,{nonNullable:!0,validators:[b.required]}),fechaInicio:new v(void 0,{nonNullable:!0,validators:[b.required]}),fechaFin:new v({value:void 0,disabled:!0},{nonNullable:!0,validators:[b.required]})});id;minDate;maxDate;ngOnInit(){let t=this.dialogService.getInstance(this.ref);t.data&&(this.id=t.data.id,this.formData.controls.idSede.setValue(t.data.idSede),this.formData.controls.idCargo.setValue(t.data.idCargo),this.formData.controls.idTrabajador.setValue(t.data.idTrabajador),this.formData.controls.fechaInicio.setValue(new Date(t.data.fechaInicio)),this.formData.controls.fechaFin.setValue(new Date(t.data.fechaFin))),this.cargarSedes(),this.cargarCargos(),this.cargarTrabajadoresActivos()}cargarSedes(){this.sedeService.findAll().subscribe({next:t=>{this.listaSedes=t}})}cargarCargos(){this.cargoService.findAll().subscribe({next:t=>{this.listaCargos=t}})}cargarTrabajadoresActivos(){this.trabajadorService.findAllActivos().subscribe({next:t=>{this.listaTrabajadores=t.map(e=>(e.labelName=`${e.identificacion} | ${e.apellido} ${e.nombre}`,e)),this.filtrar()}})}filtrar(t){this.listaTrabajadoresFiltrados=this.listaTrabajadores.filter(e=>e.asignacionSedes.map(i=>i.idSede).includes(this.formData.get("idSede")?.value)&&e.contratos[0].idCargo===this.formData.get("idCargo")?.value)}selectFechaInicio(t){this.formData.get("fechaFin")?.enable(),this.minDate=this.formData.get("fechaInicio")?.value,this.maxDate=new Date(this.minDate),this.maxDate.setDate(this.maxDate.getDate()+15)}selectFechaFin(t){let e=this.formData.get("fechaFin")?.value,i=this.formData.get("fechaInicio")?.value,m=(e.getTime()-i.getTime())/(1e3*60*60*24);this.formData.get("diasUtilizados")?.setValue(m)}onUpload(t){console.log(t.files)}guardar(){let t=this.formData.value;this.id?this.vacacionService.update(this.id,H(q({},t),{diasUtilizados:t.diasUtilizados,diasDisponibles:t.diasDisponibles-t.diasUtilizados})).subscribe({next:e=>{this.msg.success("\xA1Actualizado con \xE9xito!"),this.ref.close(e)},error:e=>{this.msg.error(e.error.message)}}):this.vacacionService.create(H(q({},t),{diasUtilizados:t.diasUtilizados,diasDisponibles:t.diasDisponibles-t.diasUtilizados})).subscribe({next:e=>{this.msg.success("\xA1Registrado con \xE9xito!"),this.ref.close(e)},error:e=>{this.msg.error(e.error.message)}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=M({type:n,selectors:[["app-form-vacaciones"]],decls:34,vars:11,consts:[["fu",""],[1,"flex","flex-col","gap-2"],[1,"grid","grid-cols-1","gap-2",3,"formGroup"],["for","idSede",1,"text-sm","font-medium"],["id","idSede","optionLabel","nombre","optionValue","id","formControlName","idSede","placeholder","Seleccione...",3,"onChange","options"],["for","idCargo",1,"text-sm","font-medium"],["id","idCargo","optionLabel","nombre","optionValue","id","formControlName","idCargo","placeholder","Seleccione...",3,"onChange","options"],["for","idTrabajador",1,"text-sm","font-medium"],["id","idTrabajador","optionLabel","labelName","optionValue","id","formControlName","idTrabajador","placeholder","Seleccione...",3,"options"],["for","diasDisponibles",1,"text-sm","font-medium"],["pInputText","","id","diasDisponibles","formControlName","diasDisponibles",3,"readonly"],["for","fechaInicio",1,"text-sm","font-medium"],["id","fechaInicio","styleClass","w-full uppercase","dateFormat","dd M yy","placeholder","DD MMM YYYY","formControlName","fechaInicio","appendTo","body",3,"ngModelChange","showIcon"],["for","fechaFin",1,"text-sm","font-medium"],["id","fechaFin","styleClass","w-full uppercase","dateFormat","dd M yy","placeholder","DD MMM YYYY","formControlName","fechaFin","appendTo","body",3,"ngModelChange","minDate","maxDate","showIcon"],["for","username",1,"text-sm","font-medium"],[1,"flex"],["mode","basic","chooseLabel","Cargar","chooseIcon","pi pi-upload","name","demo[]","accept","image/*","maxFileSize","1000000",3,"onUpload"],[1,"flex","justify-end","gap-2","mt-4"],["severity","info","size","small",3,"onClick","label","disabled"]],template:function(e,i){if(e&1){let c=x();a(0,"div",1)(1,"form",2)(2,"div",1)(3,"label",3),s(4,"Edificio"),o(),a(5,"p-select",4),g("onChange",function(l){return f(c),u(i.filtrar(l))}),o()(),a(6,"div",1)(7,"label",5),s(8,"Cargo"),o(),a(9,"p-select",6),g("onChange",function(l){return f(c),u(i.filtrar(l))}),o()(),a(10,"div",1)(11,"label",7),s(12,"Trabajador"),o(),h(13,"p-select",8),o(),a(14,"div",1)(15,"label",9),s(16,"D\xEDas disponibles"),o(),h(17,"input",10),o(),a(18,"div",1)(19,"label",11),s(20,"Fecha de inicio"),o(),a(21,"p-datepicker",12),g("ngModelChange",function(l){return f(c),u(i.selectFechaInicio(l))}),o()(),a(22,"div",1)(23,"label",13),s(24,"Fecha de fin"),o(),a(25,"p-datepicker",14),g("ngModelChange",function(l){return f(c),u(i.selectFechaFin(l))}),o()(),a(26,"div",1)(27,"label",15),s(28,"Archivos adjuntos"),o(),a(29,"div",16)(30,"p-fileupload",17,0),g("onUpload",function(l){return f(c),u(i.onUpload(l))}),o()()()(),a(32,"div",18)(33,"p-button",19),g("onClick",function(){return f(c),u(i.guardar())}),o()()()}e&2&&(r(),d("formGroup",i.formData),r(4),d("options",i.listaSedes),r(4),d("options",i.listaCargos),r(4),d("options",i.listaTrabajadoresFiltrados),r(4),d("readonly",!0),r(4),d("showIcon",!0),r(4),d("minDate",i.minDate)("maxDate",i.maxDate)("showIcon",!0),r(8),d("label",i.id?"Actualizar":"Guardar")("disabled",i.formData.invalid))},dependencies:[N,U,Ce,ge,k,he,ye,_e,Se,Ne,A,z,L,O,G,we,B,P,Ue,Ae,ze],encapsulation:2})};var Ke=()=>["nombre","apellido"],Xe=n=>[n],Je=n=>["text-xs uppercase",n],Qe=()=>[];function Ze(n,t){if(n&1&&(a(0,"th",26)(1,"div",26),s(2),o()()),n&2){let e=t.$implicit;d("ngClass",J(3,Xe,e.widthClass?e.widthClass:"")),r(),d("ngClass",J(5,Je,e.align?"text-"+e.align:"text-start")),r(),_(" ",e.header," ")}}function et(n,t){if(n&1&&(a(0,"tr"),y(1,Ze,3,7,"th",25),o()),n&2){let e=t.$implicit;r(),d("ngForOf",e)}}function tt(n,t){if(n&1){let e=x();a(0,"tr",27),g("click",function(){let c=f(e).$implicit,m=F();return u(m.edit(c))}),a(1,"td")(2,"div",28),s(3),o()(),a(4,"td")(5,"div",28),s(6),o()(),a(7,"td"),s(8),o(),a(9,"td"),s(10),o(),a(11,"td")(12,"div",28),s(13),o()(),a(14,"td")(15,"div",28),s(16),o()(),a(17,"td")(18,"div",28),s(19),o()(),a(20,"td")(21,"div",28),s(22),V(23,"date"),V(24,"uppercase"),o()(),a(25,"td")(26,"div",28),s(27),V(28,"date"),V(29,"uppercase"),o()()()}if(n&2){let e=t.$implicit;r(3),_(" ",e.orden," "),r(3),C(e.sede.nombre),r(2),C(e.trabajador==null?null:e.trabajador.nombre),r(2),C(e.trabajador==null?null:e.trabajador.apellido),r(3),_(" ",e.cargo.nombre," "),r(3),C(e.diasUtilizados),r(3),C(e.diasDisponibles),r(3),_(" ",Q(24,12,Z(23,9,e.fechaInicio,"dd MMM yyyy"))," "),r(5),_(" ",Q(29,17,Z(28,14,e.fechaFin,"dd MMM yyyy"))," ")}}function it(n,t){n&1&&(a(0,"td"),h(1,"p-skeleton"),o())}function at(n,t){if(n&1&&(a(0,"tr",30),y(1,it,2,0,"td",31),o()),n&2){let e=F(3);r(),d("ngForOf",e.cols)}}function ot(n,t){n&1&&(ne(0),ae(1,at,2,1,"tr",30,ie),re()),n&2&&(r(),oe(X(0,Qe).constructor(4)))}function nt(n,t){n&1&&(a(0,"tr")(1,"td",32)(2,"div",33),s(3," No se encontraron registros. "),o()()())}function rt(n,t){if(n&1&&y(0,ot,3,1,"ng-container",29)(1,nt,4,0,"ng-template",null,4,D),n&2){let e=K(2),i=F();d("ngIf",i.loadingTable)("ngIfElse",e)}}var Ge=class n{title="Vacaciones programadas";icon="material-symbols:person-pin-outline-rounded";dialogService=p(T);sedeService=p(Y);cargoService=p(R);trabajadorService=p(W);vacacionService=p(S);fechaSelected=new Date("2025/03/01");listaSedes=[];selectedSedes=[];listaCargos=[];selectedCargos=[];listaTrabajadores=[];listaVacaciones=[];dataTable=[];cols;exportColumns;loadingTable=!1;ngOnInit(){this.cols=[{field:"id",header:"ID",customExportHeader:"Vacaci\xF3n ID",align:"center",widthClass:"!w-20"},{field:"sede",header:"Sede",align:"center"},{field:"nombre",header:"Nombre"},{field:"apellido",header:"Apellido"},{field:"cargo",header:"Cargo",align:"center"},{field:"diasUtilizados",header:"D\xEDas utilizados",align:"center"},{field:"diasDisponibles",header:"D\xEDas disponibles",align:"center"},{field:"fechaInicio",header:"Fecha inicio",align:"center"},{field:"fechaFin",header:"Fecha fin",align:"center"}],this.exportColumns=this.cols.map(t=>({title:t.header,dataKey:t.field})),this.cargarVacaciones()}cargarVacaciones(){this.loadingTable=!0,this.cargoService.findAll().pipe($(t=>(this.listaCargos=t,this.selectedCargos=this.listaCargos.map(e=>e.id),this.sedeService.findAll())),$(t=>(this.listaSedes=t,this.selectedSedes=this.listaSedes.map(e=>e.id),this.vacacionService.findAll()))).subscribe({next:t=>{this.listaVacaciones=t,this.loadingTable=!1,this.filtrar()}})}filtrar(t){this.dataTable=this.listaVacaciones.filter(e=>this.selectedSedes.includes(e.idSede)&&this.selectedCargos.includes(e.idCargo))}addNew(){this.dialogService.open(w,{header:"Establecer vacaciones",styleClass:"modal-md",modal:!0,dismissableMask:!0,closable:!0}).onClose.subscribe(e=>{e&&this.cargarVacaciones()})}edit(t){this.dialogService.open(w,{header:"Detalle de vacaciones",styleClass:"modal-md",position:"top",data:t,modal:!0,dismissableMask:!0,closable:!0}).onClose.subscribe(i=>{i&&this.cargarVacaciones()})}filterGlobal(t,e){t.filterGlobal(e.value,"contains")}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=M({type:n,selectors:[["app-vacaciones"]],features:[le([T])],decls:35,vars:16,consts:[["dt1",""],["header",""],["body",""],["emptymessage",""],["elseTemplate",""],[1,"flex","flex-col","h-full"],[1,"flex","flex-col","justify-center","gap-4","px-6","py-4","h-[8.5rem]"],[1,"flex","justify-between","items-center","gap-4"],[1,"flex","items-center","gap-4"],["data-inline","false",1,"iconify","icon","font-bold","text-4xl"],[1,"text-2xl","font-semibold"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],["id","fechaInicio","view","month","dateFormat","MM yy","placeholder","Seleccionar mes","showIcon","","iconDisplay","input","styleClass","w-44","appendTo","body","pTooltip","Mes","tooltipPosition","top","tooltipStyleClass","text-sm",3,"ngModelChange","ngModel","readonlyInput"],["optionLabel","nombre","optionValue","id","placeholder","Edificios","styleClass","w-42","pTooltip","Edificios","tooltipPosition","top","tooltipStyleClass","text-sm",3,"ngModelChange","onChange","options","ngModel","maxSelectedLabels"],["optionLabel","nombre","optionValue","id","placeholder","Cargos","styleClass","w-42","pTooltip","Cargos","tooltipPosition","top","tooltipStyleClass","text-sm",3,"ngModelChange","onChange","options","ngModel","maxSelectedLabels"],["styleClass","pi pi-search"],["type","text","pInputText","","placeholder","Buscar",3,"input"],["severity","info","size","small"],[1,"flex","justify-center","items-center","font-medium","gap-1"],["data-icon","material-symbols:download-rounded","data-inline","false",1,"iconify","icon","text-lg"],["severity","info","size","small",3,"click"],["data-icon","material-symbols:add-rounded","data-inline","false",1,"iconify","icon","text-lg"],[1,"flex","flex-col","h-[calc(100%","-","8.5rem)]","px-6"],["dataKey","id","stripedRows","","scrollHeight","720px","styleClass","w-full","exportFilename","vacaciones",3,"columns","value","scrollable","exportHeader","globalFilterFields"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"hover:!bg-slate-200","cursor-pointer",3,"click"],[1,"text-center","text-sm"],[4,"ngIf","ngIfElse"],[1,"h-12"],[4,"ngFor","ngForOf"],["colspan","100"],[1,"text-center","text-sm","font-extralight"]],template:function(e,i){if(e&1){let c=x();a(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8),h(4,"i",9),a(5,"h2",10),s(6),o()()(),a(7,"div",11)(8,"div",12)(9,"p-datepicker",13),j("ngModelChange",function(l){return f(c),E(i.fechaSelected,l)||(i.fechaSelected=l),u(l)}),o(),a(10,"p-multiselect",14),j("ngModelChange",function(l){return f(c),E(i.selectedSedes,l)||(i.selectedSedes=l),u(l)}),g("onChange",function(l){return f(c),u(i.filtrar(l.value))}),o(),a(11,"p-multiselect",15),j("ngModelChange",function(l){return f(c),E(i.selectedCargos,l)||(i.selectedCargos=l),u(l)}),g("onChange",function(l){return f(c),u(i.filtrar(l.value))}),o(),a(12,"p-iconfield"),h(13,"p-inputicon",16),a(14,"input",17),g("input",function(l){f(c);let Re=K(28);return u(i.filterGlobal(Re,l.target))}),o()()(),a(15,"div",12)(16,"p-button",18)(17,"div",19),h(18,"i",20),a(19,"div"),s(20,"XLS"),o()()(),a(21,"p-button",21),g("click",function(){return f(c),u(i.addNew())}),a(22,"div",19),h(23,"i",22),a(24,"div"),s(25,"AGREGAR"),o()()()()()(),a(26,"div",23)(27,"p-table",24,0),y(29,et,2,1,"ng-template",null,1,D)(31,tt,30,19,"ng-template",null,2,D)(33,rt,3,2,"ng-template",null,3,D),o()()()}e&2&&(r(4),te("data-icon",i.icon),r(2),C(i.title),r(3),I("ngModel",i.fechaSelected),d("readonlyInput",!0),r(),d("options",i.listaSedes),I("ngModel",i.selectedSedes),d("maxSelectedLabels",2),r(),d("options",i.listaCargos),I("ngModel",i.selectedCargos),d("maxSelectedLabels",2),r(16),d("columns",i.cols)("value",i.dataTable)("scrollable",!0)("exportHeader","customExportHeader")("globalFilterFields",X(15,Ke)))},dependencies:[N,se,de,ce,me,pe,U,k,ve,je,Ee,L,O,Fe,Me,Ve,xe,A,z,G,Pe,B,P,Te,De,Le,Oe],encapsulation:2})};export{Ge as VacacionesComponent};
