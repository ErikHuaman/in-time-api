import{a as ke,b as Pe}from"./chunk-HSUUTGKP.js";import{a as je}from"./chunk-W6ENELZB.js";import{b as Ve}from"./chunk-TWLOV2EE.js";import{b as Ne}from"./chunk-AKEGUMGJ.js";import{b as Fe}from"./chunk-OXAP3N3H.js";import"./chunk-HMF6RJK6.js";import{a as H}from"./chunk-TVRGOZ6Z.js";import{a as Y}from"./chunk-LGAXEAXJ.js";import{a as q}from"./chunk-ZGEBOACG.js";import{a as Ee,b as Ie}from"./chunk-KOIAJ6TH.js";import"./chunk-G453X5NG.js";import{d as R,e as G,f as xe,g as Ae,l as Me,n as De}from"./chunk-CWKDICKV.js";import{h as Te,i as W}from"./chunk-NYQZODR7.js";import{c as we,d as T}from"./chunk-BBS5CLCL.js";import{c as v,e as k,f as ue,g as fe,i as C,j as ge,k as he,l as be,o as ve,r as P,s as Ce,t as Se,u as O}from"./chunk-7W2NGOAN.js";import"./chunk-FNTIPBS5.js";import"./chunk-A3HZ2PBM.js";import"./chunk-2BOM3PMI.js";import{b as _e,d as ye}from"./chunk-RVXUJXBG.js";import{a as ce}from"./chunk-Q2HHWBKA.js";import"./chunk-4Q3JVAKG.js";import{b as pe}from"./chunk-MCE4IIOZ.js";import{Ea as B,Fa as L}from"./chunk-F2X7M4DW.js";import"./chunk-WCGJ44IN.js";import{B as V,m as ne,o as re,p as le,v as de,w as se,z as me}from"./chunk-J6775IRK.js";import{$ as m,$b as z,Cb as Z,Eb as ee,Fb as te,Gb as i,Hb as o,Ib as u,Jb as ie,Kb as oe,Mb as $,Rb as f,Sb as E,Ta as r,V as J,ac as l,bc as b,cc as x,ec as I,fa as g,fc as F,ga as h,gc as j,hb as w,hc as ae,ic as U,jc as K,nb as y,r as D,sc as S,tc as N,uc as X,vb as Q,wb as d,wc as A}from"./chunk-VDH5VFWZ.js";import"./chunk-EQDQRRRY.js";var _=class a{url=`${ce.apiUrl}/adelantos`;http=m(pe);findAll(){return this.http.get(this.url)}findOne(t){return this.http.get(`${this.url}/${t}`)}create(t){return this.http.post(`${this.url}`,t)}update(t,e){return this.http.put(`${this.url}/${t}`,e)}static \u0275fac=function(e){return new(e||a)};static \u0275prov=J({token:a,factory:a.\u0275fac,providedIn:"root"})};var M=class a{ref=m(we);dialogService=m(T);cargoService=m(Y);sedeService=m(H);trabajadorService=m(q);adelantoService=m(_);msg=m(je);listaTrabajadores=[];listaTrabajadoresFiltrados=[];listaSedes=[];listaCargos=[];formData=new fe({idSede:new C(void 0,{nonNullable:!0,validators:[v.required]}),idCargo:new C(void 0,{nonNullable:!0,validators:[v.required]}),idTrabajador:new C(void 0,{nonNullable:!0,validators:[v.required]}),montoAdelanto:new C(void 0,{nonNullable:!0,validators:[v.required]}),cuotasDescuento:new C(void 0,{nonNullable:!0,validators:[v.required]}),fechaAdelanto:new C(void 0,{nonNullable:!0,validators:[v.required]}),fechaDescuento:new C(void 0,{nonNullable:!0,validators:[v.required]})});id;listaMotivos=[{id:1,nombre:"Motivos personales"}];ngOnInit(){let t=this.dialogService.getInstance(this.ref);t.data&&(this.id=t.data.id,this.formData.controls.idSede.setValue(t.data.idSede),this.formData.controls.idCargo.setValue(t.data.idCargo),this.formData.controls.idTrabajador.setValue(t.data.idTrabajador),this.formData.controls.montoAdelanto.setValue(t.data.montoAdelanto),this.formData.controls.cuotasDescuento.setValue(t.data.cuotasDescuento),this.formData.controls.fechaAdelanto.setValue(new Date(t.data.fechaAdelanto)),this.formData.controls.fechaDescuento.setValue(new Date(t.data.fechaDescuento))),this.cargarSedes(),this.cargarCargos(),this.cargarTrabajadoresActivos()}cargarSedes(){this.sedeService.findAll().subscribe({next:t=>{this.listaSedes=t}})}cargarCargos(){this.cargoService.findAll().subscribe({next:t=>{this.listaCargos=t}})}cargarTrabajadoresActivos(){this.trabajadorService.findAllActivos().subscribe({next:t=>{this.listaTrabajadores=t.filter(e=>e.asignacionSedes[0]?.idSede).map(e=>(e.labelName=`${e.identificacion} | ${e.apellido} ${e.nombre}`,e)),this.filtrar(null)}})}filtrar(t){this.listaTrabajadoresFiltrados=this.listaTrabajadores.filter(e=>e.asignacionSedes[0]?.idSede===this.formData.get("idSede")?.value&&e.contratos[0].idCargo===this.formData.get("idCargo")?.value)}onUpload(t){console.log(t.files)}guardar(){let t=this.formData.value;this.id?this.adelantoService.update(this.id,t).subscribe({next:e=>{this.msg.success("\xA1Actualizado con \xE9xito!"),this.ref.close(e)},error:e=>{this.msg.error(e.error.message)}}):this.adelantoService.create(t).subscribe({next:e=>{this.msg.success("\xA1Registrado con \xE9xito!"),this.ref.close(e)},error:e=>{this.msg.error(e.error.message)}})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=w({type:a,selectors:[["app-form-adelanto"]],decls:32,vars:8,consts:[[1,"flex","flex-col","gap-2"],[1,"grid","grid-cols-1","gap-2",3,"formGroup"],["for","idSede",1,"text-sm","font-medium"],["id","idSede","optionLabel","nombre","optionValue","id","formControlName","idSede","placeholder","Seleccione...",3,"onChange","options"],["for","idCargo",1,"text-sm","font-medium"],["id","idCargo","optionLabel","nombre","optionValue","id","formControlName","idCargo","placeholder","Seleccione...",3,"onChange","options"],["for","idTrabajador",1,"text-sm","font-medium"],["id","idTrabajador","optionLabel","labelName","optionValue","id","formControlName","idTrabajador","placeholder","Seleccione...",3,"options"],["for","montoAdelanto",1,"text-sm","font-medium"],["id","montoAdelanto","formControlName","montoAdelanto","mode","currency","currency","PEN","locale","es-PE"],["for","cuotasDescuento",1,"text-sm","font-medium"],["id","cuotasDescuento","formControlName","cuotasDescuento"],["for","fechaAdelanto",1,"text-sm","font-medium"],["id","fechaAdelanto","styleClass","w-full uppercase","dateFormat","dd M yy","placeholder","DD MMM YYYY","formControlName","fechaAdelanto","appendTo","body",3,"showIcon"],["for","fechaDescuento",1,"text-sm","font-medium"],["id","fechaDescuento","styleClass","w-full uppercase","dateFormat","dd M yy","placeholder","DD MMM YYYY","formControlName","fechaDescuento","appendTo","body",3,"showIcon"],[1,"flex","justify-end","gap-2","mt-4"],["severity","info","size","small",3,"onClick","label","disabled"]],template:function(e,n){e&1&&(i(0,"div",0)(1,"form",1)(2,"div",0)(3,"label",2),l(4,"Edificio"),o(),i(5,"p-select",3),f("onChange",function(c){return n.filtrar(c)}),o()(),i(6,"div",0)(7,"label",4),l(8,"Cargo"),o(),i(9,"p-select",5),f("onChange",function(c){return n.filtrar(c)}),o()(),i(10,"div",0)(11,"label",6),l(12,"Trabajador"),o(),u(13,"p-select",7),o(),i(14,"div",0)(15,"label",8),l(16,"Monto de adelanto"),o(),u(17,"p-inputnumber",9),o(),i(18,"div",0)(19,"label",10),l(20,"Cuotas de descuento"),o(),u(21,"p-inputnumber",11),o(),i(22,"div",0)(23,"label",12),l(24,"Fecha de adelanto"),o(),u(25,"p-datepicker",13),o(),i(26,"div",0)(27,"label",14),l(28,"Fecha de inicio de descuento"),o(),u(29,"p-datepicker",15),o()(),i(30,"div",16)(31,"p-button",17),f("onClick",function(){return n.guardar()}),o()()()),e&2&&(r(),d("formGroup",n.formData),r(4),d("options",n.listaSedes),r(4),d("options",n.listaCargos),r(4),d("options",n.listaTrabajadoresFiltrados),r(12),d("showIcon",!0),r(4),d("showIcon",!0),r(2),d("label",n.id?"Actualizar":"Guardar")("disabled",n.formData.invalid))},dependencies:[V,P,he,k,ue,Ce,be,ve,Fe,O,Ae,xe,L,B,W,Te,G,R,Ne,Ve],encapsulation:2})};var qe=()=>["nombre","apellido"],He=a=>[a],$e=a=>["text-xs uppercase",a],ze=()=>[];function Ue(a,t){if(a&1&&(i(0,"th",26)(1,"div",26),l(2),o()()),a&2){let e=t.$implicit;d("ngClass",K(3,He,e.widthClass?e.widthClass:"")),r(),d("ngClass",K(5,$e,e.align?"text-"+e.align:"text-start")),r(),x(" ",e.header," ")}}function Ke(a,t){if(a&1&&(i(0,"tr"),y(1,Ue,3,7,"th",25),o()),a&2){let e=t.$implicit;r(),d("ngForOf",e)}}function Xe(a,t){if(a&1){let e=$();i(0,"tr",27),f("click",function(){let p=g(e).$implicit,c=E();return h(c.edit(p))}),i(1,"td")(2,"div",28),l(3),o()(),i(4,"td")(5,"div",29),l(6),o()(),i(7,"td")(8,"div",29),l(9),o()(),i(10,"td")(11,"div",28),l(12),o()(),i(13,"td")(14,"div",28),l(15),o()(),i(16,"td")(17,"div",28),l(18),S(19,"currency"),o()(),i(20,"td")(21,"div",28),l(22),o()(),i(23,"td")(24,"div",28),l(25),S(26,"date"),S(27,"uppercase"),o()(),i(28,"td")(29,"div",28),l(30),S(31,"date"),S(32,"uppercase"),o()()()}if(a&2){let e=t.$implicit;r(3),b(e.orden),r(3),b(e.trabajador==null?null:e.trabajador.nombre),r(3),x(" ",e.trabajador==null?null:e.trabajador.apellido," "),r(3),b(e.sede==null?null:e.sede.nombre),r(3),b(e.cargo==null?null:e.cargo.nombre),r(3),b(N(19,9,e.montoAdelanto)),r(4),b(e.cuotasDescuento),r(3),x(" ",N(27,14,X(26,11,e.fechaAdelanto,"dd MMM yyyy"))," "),r(5),x(" ",N(32,19,X(31,16,e.fechaDescuento,"dd MMM yyyy"))," ")}}function Je(a,t){a&1&&(i(0,"td"),u(1,"p-skeleton"),o())}function Qe(a,t){if(a&1&&(i(0,"tr",31),y(1,Je,2,0,"td",32),o()),a&2){let e=E(3);r(),d("ngForOf",e.cols)}}function Ze(a,t){a&1&&(ie(0),ee(1,Qe,2,1,"tr",31,Z),oe()),a&2&&(r(),te(U(0,ze).constructor(4)))}function et(a,t){a&1&&(i(0,"tr")(1,"td",33)(2,"div",34),l(3," No se encontraron registros. "),o()()())}function tt(a,t){if(a&1&&y(0,Ze,3,1,"ng-container",30)(1,et,4,0,"ng-template",null,4,A),a&2){let e=z(2),n=E();d("ngIf",n.loadingTable)("ngIfElse",e)}}var Be=class a{title="Adelantos de sueldo";icon="material-symbols:person-pin-outline-rounded";dialogService=m(T);sedeService=m(H);cargoService=m(Y);trabajadorService=m(q);adelantoService=m(_);fechaSelected=new Date("2025/03/01");listaSedes=[];selectedSedes=[];listaCargos=[];selectedCargos=[];listaTrabajadores=[];listaAdelantos=[];dataTable=[];cols;exportColumns;loadingTable=!1;ngOnInit(){this.cols=[{field:"id",header:"ID",customExportHeader:"PermisoTrabajador ID",align:"center",widthClass:"!w-20"},{field:"nombre",header:"Nombre"},{field:"apellido",header:"Apellido"},{field:"sede",header:"Sede",align:"center"},{field:"cargo",header:"Cargo",align:"center"},{field:"montoAdelanto",header:"Monto adelantado",align:"center"},{field:"cuotasDescuento",header:"Cuotas de descuento",align:"center"},{field:"fechaAdelanto",header:"Fecha de adelanto",align:"center"},{field:"fechaDescuento",header:"Fecha de descuento",align:"center"}],this.exportColumns=this.cols.map(t=>({title:t.header,dataKey:t.field})),this.cargarAdelantos()}cargarAdelantos(){this.loadingTable=!0,this.cargoService.findAll().pipe(D(t=>(this.listaCargos=t,this.selectedCargos=this.listaCargos.map(e=>e.id),this.sedeService.findAll())),D(t=>(this.listaSedes=t,this.selectedSedes=this.listaSedes.map(e=>e.id),this.trabajadorService.findAllActivos())),D(t=>(this.listaTrabajadores=t,this.adelantoService.findAll()))).subscribe({next:t=>{this.loadingTable=!1,this.listaAdelantos=t,this.filtrar()}})}filtrar(t){this.dataTable=this.listaAdelantos.filter(e=>this.selectedSedes.includes(e.idSede)&&this.selectedCargos.includes(e.idCargo))}addNew(){this.dialogService.open(M,{header:"Registrar adelanto de sueldo",styleClass:"modal-md",position:"top",modal:!0,dismissableMask:!0,closable:!0}).onClose.subscribe(e=>{e&&this.cargarAdelantos()})}edit(t){this.dialogService.open(M,{header:"Inactivar trabajador",styleClass:"modal-md",position:"top",data:t,modal:!0,dismissableMask:!0,closable:!0}).onClose.subscribe(n=>{n&&this.cargarAdelantos()})}filterGlobal(t,e){t.filterGlobal(e.value,"contains")}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=w({type:a,selectors:[["app-adelantos"]],features:[ae([T])],decls:35,vars:16,consts:[["dt1",""],["header",""],["body",""],["emptymessage",""],["elseTemplate",""],[1,"flex","flex-col","h-full"],[1,"flex","flex-col","justify-center","gap-4","px-6","py-4","h-[8.5rem]"],[1,"flex","justify-between","items-center","gap-4"],[1,"flex","items-center","gap-4"],["data-inline","false",1,"iconify","icon","font-bold","text-4xl"],[1,"text-2xl","font-semibold"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],["id","fechaInicio","view","month","dateFormat","MM yy","placeholder","Seleccionar mes","showIcon","","iconDisplay","input","styleClass","w-44","appendTo","body","pTooltip","Mes","tooltipPosition","top","tooltipStyleClass","text-sm",3,"ngModelChange","ngModel","readonlyInput"],["optionLabel","nombre","optionValue","id","placeholder","Edificios","styleClass","w-42","pTooltip","Edificios","tooltipPosition","top","tooltipStyleClass","text-sm",3,"ngModelChange","onChange","options","ngModel","maxSelectedLabels"],["optionLabel","nombre","optionValue","id","placeholder","Cargos","styleClass","w-42","pTooltip","Cargos","tooltipPosition","top","tooltipStyleClass","text-sm",3,"ngModelChange","onChange","options","ngModel","maxSelectedLabels"],["styleClass","pi pi-search"],["type","text","pInputText","","placeholder","Buscar",3,"input"],["severity","info","size","small"],[1,"flex","justify-center","items-center","font-medium","gap-1"],["data-icon","material-symbols:download-rounded","data-inline","false",1,"iconify","icon","text-lg"],["severity","info","size","small",3,"click"],["data-icon","material-symbols:add-rounded","data-inline","false",1,"iconify","icon","text-lg"],[1,"flex","flex-col","h-[calc(100%","-","8.5rem)]","px-6"],["stripedRows","","scrollHeight","720px","styleClass","w-full","exportFilename","adelantos",3,"columns","value","scrollable","exportHeader","globalFilterFields"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"hover:!bg-slate-200","cursor-pointer",3,"click"],[1,"text-center","text-sm"],[1,"text-start","text-sm"],[4,"ngIf","ngIfElse"],[1,"h-12"],[4,"ngFor","ngForOf"],["colspan","100"],[1,"text-center","text-sm","font-extralight"]],template:function(e,n){if(e&1){let p=$();i(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8),u(4,"i",9),i(5,"h2",10),l(6),o()()(),i(7,"div",11)(8,"div",12)(9,"p-datepicker",13),j("ngModelChange",function(s){return g(p),F(n.fechaSelected,s)||(n.fechaSelected=s),h(s)}),o(),i(10,"p-multiselect",14),j("ngModelChange",function(s){return g(p),F(n.selectedSedes,s)||(n.selectedSedes=s),h(s)}),f("onChange",function(s){return g(p),h(n.filtrar(s.value))}),o(),i(11,"p-multiselect",15),j("ngModelChange",function(s){return g(p),F(n.selectedCargos,s)||(n.selectedCargos=s),h(s)}),f("onChange",function(s){return g(p),h(n.filtrar(s.value))}),o(),i(12,"p-iconfield"),u(13,"p-inputicon",16),i(14,"input",17),f("input",function(s){g(p);let Le=z(28);return h(n.filterGlobal(Le,s.target))}),o()()(),i(15,"div",12)(16,"p-button",18)(17,"div",19),u(18,"i",20),i(19,"div"),l(20,"XLS"),o()()(),i(21,"p-button",21),f("click",function(){return g(p),h(n.addNew())}),i(22,"div",19),u(23,"i",22),i(24,"div"),l(25,"AGREGAR"),o()()()()()(),i(26,"div",23)(27,"p-table",24,0),y(29,Ke,2,1,"ng-template",null,1,A)(31,Xe,33,21,"ng-template",null,2,A)(33,tt,3,2,"ng-template",null,3,A),o()()()}e&2&&(r(4),Q("data-icon",n.icon),r(2),b(n.title),r(3),I("ngModel",n.fechaSelected),d("readonlyInput",!0),r(),d("options",n.listaSedes),I("ngModel",n.selectedSedes),d("maxSelectedLabels",2),r(),d("options",n.listaCargos),I("ngModel",n.selectedCargos),d("maxSelectedLabels",2),r(16),d("columns",n.cols)("value",n.dataTable)("scrollable",!0)("exportHeader","customExportHeader")("globalFilterFields",U(15,qe)))},dependencies:[V,ne,re,le,de,me,se,P,k,ge,Ie,Ee,L,B,De,Me,ye,_e,O,Se,W,G,R,Pe,ke],encapsulation:2})};export{Be as AdelantosComponent};
