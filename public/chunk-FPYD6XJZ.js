import{c as R}from"./chunk-6R7BUVFI.js";import{a as U}from"./chunk-Q2HHWBKA.js";import{b as M}from"./chunk-MCE4IIOZ.js";import{$ as l,Hc as y,Ic as d,V as h,la as k,ta as w,ua as I}from"./chunk-VDH5VFWZ.js";import{a as o,b as g}from"./chunk-EQDQRRRY.js";function D(e){let t=y(()=>e());return J(t)?new Proxy(e,{get(n,r){return r in t?(w(n[r])||Object.defineProperty(n,r,{value:d(()=>n()[r]),configurable:!0}),D(n[r])):n[r]}}):e}var $=[WeakSet,WeakMap,Promise,Date,Error,RegExp,ArrayBuffer,DataView,Function];function J(e){if(e===null||typeof e!="object"||N(e))return!1;let t=Object.getPrototypeOf(e);if(t===Object.prototype)return!0;for(;t&&t!==Object.prototype;){if($.includes(t.constructor))return!1;t=Object.getPrototypeOf(t)}return t===Object.prototype}function N(e){return typeof e?.[Symbol.iterator]=="function"}var q=new WeakMap,i=Symbol("STATE_SOURCE");function a(e,...t){e[i].update(n=>t.reduce((r,s)=>o(o({},r),typeof s=="function"?s(r):s),n)),z(e)}function B(e){return e[i]()}function V(e){return q.get(e[i])||[]}function z(e){let t=V(e);for(let n of t){let r=y(()=>B(e));n(r)}}function O(...e){let t=[...e],n=typeof t[0]=="function"?{}:t.shift(),r=t;return(()=>{class c{constructor(){let u=r.reduce((p,K)=>K(p),G()),{stateSignals:S,props:E,methods:P,hooks:W}=u,b=o(o(o({},S),E),P);this[i]=u[i];for(let p of Reflect.ownKeys(b))this[p]=b[p];let{onInit:v,onDestroy:j}=W;v&&v(),j&&l(k).onDestroy(j)}static \u0275fac=function(S){return new(S||c)};static \u0275prov=h({token:c,factory:c.\u0275fac,providedIn:n.providedIn||null})}return c})()}function G(){return{[i]:I({}),stateSignals:{},props:{},methods:{},hooks:{}}}function L(e){return t=>{let n=e(o(o(o({[i]:t[i]},t.stateSignals),t.props),t.methods));return Reflect.ownKeys(n),g(o({},t),{props:o(o({},t.props),n)})}}function T(e){return L(e)}function x(e){return t=>{let n=e(o(o(o({[i]:t[i]},t.stateSignals),t.props),t.methods));return Reflect.ownKeys(n),g(o({},t),{methods:o(o({},t.methods),n)})}}function A(e){return t=>{let n=typeof e=="function"?e():e,r=Reflect.ownKeys(n);t[i].update(c=>o(o({},c),n));let s=r.reduce((c,f)=>{let u=d(()=>t[i]()[f]);return g(o({},c),{[f]:D(u)})},{});return g(o({},t),{stateSignals:o(o({},t.stateSignals),s)})}}var m=class e{url=`${U.apiUrl}/auth`;http=l(M);login(t,n){return this.http.post(`${this.url}/login`,{username:t,password:n})}getProfile(){return this.http.get(`${this.url}/profile`)}verificarModulo(t){return this.http.post(`${this.url}/verificarModulo`,{url:t})}logout(){localStorage.removeItem("user"),localStorage.removeItem("token"),console.log("Sesi\xF3n cerrada")}storeToken(t){localStorage.setItem("token",t)}storeUser(t){localStorage.setItem("user",JSON.stringify(t))}getToken(){return localStorage.getItem("token")}static \u0275fac=function(n){return new(n||e)};static \u0275prov=h({token:e,factory:e.\u0275fac,providedIn:"root"})};var C=localStorage.getItem("user"),Q={user:C?JSON.parse(C):null,loading:!1,error:null},ft=O({providedIn:"root"},A(Q),T(({user:e})=>({isAuthenticated:d(()=>!!e())})),x(e=>{let t=l(m),n=l(R);return{login(r,s,c){a(e,{loading:!0}),t.login(r,s).subscribe({next:({token:f,user:u})=>{t.storeToken(f),t.storeUser(u),a(e,{user:u,loading:!1,error:null}),n.navigate([c??"/"])},error:f=>a(e,{error:f.error.message,loading:!1}),complete:()=>a(e,{loading:!1})})},checkSession(){t.getToken()&&(a(e,{loading:!0}),t.getProfile().subscribe({next:s=>{t.storeUser(s),a(e,{user:s})},error:()=>{t.logout(),a(e,{user:null}),n.navigate(["/auth/login"])},complete:()=>a(e,{loading:!1})}))},logout(){t.logout(),a(e,{user:null}),n.navigate(["/auth/login"])}}}));export{m as a,ft as b};
