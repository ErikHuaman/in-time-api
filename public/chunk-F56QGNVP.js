import{b as Fe}from"./chunk-TWLOV2EE.js";import{a as De,b as Te}from"./chunk-AKEGUMGJ.js";import{b as xe}from"./chunk-OXAP3N3H.js";import"./chunk-HMF6RJK6.js";import{a as Oe}from"./chunk-WA5IO6KH.js";import{b as Ie}from"./chunk-RVQOAWJC.js";import{a as Ee}from"./chunk-TVRGOZ6Z.js";import{a as we}from"./chunk-LGAXEAXJ.js";import{a as ve,b as _e}from"./chunk-KOIAJ6TH.js";import"./chunk-G453X5NG.js";import{d as A,e as H,l as Me,n as Se}from"./chunk-CWKDICKV.js";import{i as N}from"./chunk-NYQZODR7.js";import{c as be,d as T}from"./chunk-BBS5CLCL.js";import{b as ce,c as _,e as O,f as se,g as de,i as w,j as V,k as me,l as pe,o as ue,r as k,s as fe,t as W,u as j}from"./chunk-7W2NGOAN.js";import"./chunk-FNTIPBS5.js";import"./chunk-A3HZ2PBM.js";import"./chunk-2BOM3PMI.js";import{b as ge,d as he,f as Ce,g as ye}from"./chunk-RVXUJXBG.js";import{a as le}from"./chunk-Q2HHWBKA.js";import"./chunk-4Q3JVAKG.js";import{b as oe}from"./chunk-MCE4IIOZ.js";import{Ea as B,Fa as P}from"./chunk-F2X7M4DW.js";import"./chunk-WCGJ44IN.js";import{B as I,m as ne,v as ae,w as re}from"./chunk-J6775IRK.js";import{$ as p,$b as $,Gb as t,Hb as n,Ib as v,Mb as z,Rb as C,Sb as Z,Ta as l,V as X,ac as o,bc as E,cc as D,dc as ee,ec as u,fa as y,fc as f,ga as M,gc as g,hb as F,hc as ie,ic as h,jc as Y,nb as Q,r as J,sc as S,tc as te,uc as b,v as K,vb as q,wb as c,wc as U}from"./chunk-VDH5VFWZ.js";import{a as R}from"./chunk-EQDQRRRY.js";var L=class m{url=`${le.apiUrl}/correccionMarcacion`;http=p(oe);findAll(){return this.http.get(this.url)}findOne(r){return this.http.get(`${this.url}/${r}`)}create(r){return this.http.post(`${this.url}`,r)}update(r,e){return this.http.put(`${this.url}/${r}`,e)}static \u0275fac=function(e){return new(e||m)};static \u0275prov=X({token:m,factory:m.\u0275fac,providedIn:"root"})};var x=()=>({standalone:!0}),G=class m{corrected=!1;ref=p(be);dialogService=p(T);correccionMarcacionService=p(L);formData=new de({idAsistencia:new w(void 0,{nonNullable:!0,validators:[_.required]}),fecha:new w(void 0,{nonNullable:!0,validators:[_.required]}),marcacionEntrada:new w({value:void 0,disabled:!1},{nonNullable:!0,validators:[_.required]}),marcacionSalida:new w({value:void 0,disabled:!1},{nonNullable:!0,validators:[_.required]}),nota:new w(void 0,{nonNullable:!0,validators:[_.required]})});id;entrada;salida;trabajador;cargo;sede;fecha;marcacionEntrada;marcacionSalida;ngOnInit(){let e=this.dialogService.getInstance(this.ref).data;e&&(this.id=e.asistencia?.correccion?.id,this.trabajador=`${e?.identificacion} | ${e?.nombre}`,this.cargo=e.cargo?.nombre,this.sede=e.sede?.nombre,this.fecha=new Date(e.fecha),this.formData.get("idAsistencia")?.setValue(e.asistencia.id),this.formData.get("fecha")?.setValue(new Date(e.fecha)),e.asistencia?.correccion?.marcacionEntrada&&(this.marcacionEntrada=new Date(e.asistencia?.correccion?.marcacionEntrada),this.formData.get("marcacionEntrada")?.setValue(this.marcacionEntrada)),e.asistencia?.correccion?.marcacionSalida&&(this.marcacionSalida=new Date(e.asistencia?.correccion?.marcacionSalida),this.formData.get("marcacionSalida")?.setValue(this.marcacionSalida)),this.formData.get("nota")?.setValue(e.asistencia?.correccion?.nota),this.entrada=e.horario?.entrada?new Date(e.horario.entrada):void 0,this.salida=e.horario?.salida?new Date(e.horario.salida):void 0)}selectEntrada(r){if(this.entrada){let e=new Date(this.entrada);e.setHours(this.entrada.getHours(),this.entrada.getMinutes(),0,0),this.formData.get("marcacionEntrada")?.setValue(e)}}selectSalida(r){if(this.salida){let e=new Date(this.salida);e.setHours(this.salida.getHours(),this.salida.getMinutes(),0,0),this.formData.get("marcacionSalida")?.setValue(e)}}guardar(){let r=this.formData.value;this.id?this.correccionMarcacionService.update(this.id,R({},r)).subscribe({next:e=>{this.ref.close(e)}}):this.correccionMarcacionService.create(R({},r)).subscribe({next:e=>{this.ref.close(e)}})}static \u0275fac=function(e){return new(e||m)};static \u0275cmp=F({type:m,selectors:[["app-form-correccion-marcacion"]],decls:34,vars:28,consts:[[1,"flex","flex-col","gap-2",3,"formGroup"],[1,"flex","flex-col","gap-2"],["for","username",1,"text-sm","font-medium"],["pInputText","","id","nombre","readonly","","disabled","",3,"ngModelChange","ngModel","ngModelOptions"],["for","fechaAsistencia",1,"text-sm","font-medium"],["id","fechaAsistencia","styleClass","w-full uppercase","dateFormat","dd M yy","placeholder","DD MMM YYYY","readonly","","disabled","","appendTo","body",3,"ngModelChange","showIcon","ngModel","ngModelOptions"],[1,"flex","gap-6","justify-center"],["for","username",1,"text-center","text-sm","font-medium"],[1,"flex","justify-center"],["inputId","calendar-timeonly","styleClass","w-32",3,"ngModelChange","timeOnly","ngModel","ngModelOptions","readonlyInput","showIcon"],["inputId","calendar-timeonly","styleClass","w-32",3,"ngModelChange","onClickOutside","timeOnly","ngModel","ngModelOptions","readonlyInput","showIcon"],["formControlName","nota","rows","3","cols","30","pTextarea",""],[1,"flex","justify-end","gap-2","mt-4"],["severity","info","size","small",3,"onClick","label","disabled"]],template:function(e,i){e&1&&(t(0,"form",0)(1,"div",1)(2,"label",2),o(3," Trabajador "),n(),t(4,"input",3),g("ngModelChange",function(a){return f(i.trabajador,a)||(i.trabajador=a),a}),n()(),t(5,"div",1)(6,"label",2),o(7," Cargo "),n(),t(8,"input",3),g("ngModelChange",function(a){return f(i.cargo,a)||(i.cargo=a),a}),n()(),t(9,"div",1)(10,"label",2),o(11," Edificio "),n(),t(12,"input",3),g("ngModelChange",function(a){return f(i.sede,a)||(i.sede=a),a}),n()(),t(13,"div",1)(14,"label",4),o(15," Fecha de asistencia "),n(),t(16,"p-datepicker",5),g("ngModelChange",function(a){return f(i.fecha,a)||(i.fecha=a),a}),n()(),t(17,"div",6)(18,"div",1)(19,"label",7),o(20," Hora entrada "),n(),t(21,"div",8)(22,"p-datepicker",9),g("ngModelChange",function(a){return f(i.marcacionEntrada,a)||(i.marcacionEntrada=a),a}),C("ngModelChange",function(a){return i.selectEntrada(a)}),n()()(),t(23,"div",1)(24,"label",7),o(25," Hora salida "),n(),t(26,"div",8)(27,"p-datepicker",10),g("ngModelChange",function(a){return f(i.marcacionSalida,a)||(i.marcacionSalida=a),a}),C("onClickOutside",function(a){return i.selectSalida(a)}),n()()()(),t(28,"div",1)(29,"label",2),o(30,"Nota"),n(),v(31,"textarea",11),n(),t(32,"div",12)(33,"p-button",13),C("onClick",function(){return i.guardar()}),n()()()),e&2&&(c("formGroup",i.formData),l(4),u("ngModel",i.trabajador),c("ngModelOptions",h(22,x)),l(4),u("ngModel",i.cargo),c("ngModelOptions",h(23,x)),l(4),u("ngModel",i.sede),c("ngModelOptions",h(24,x)),l(4),c("showIcon",!0),u("ngModel",i.fecha),c("ngModelOptions",h(25,x)),l(6),c("timeOnly",!0),u("ngModel",i.marcacionEntrada),c("ngModelOptions",h(26,x))("readonlyInput",!0)("showIcon",!0),l(5),c("timeOnly",!0),u("ngModel",i.marcacionSalida),c("ngModelOptions",h(27,x))("readonlyInput",!0)("showIcon",!0),l(6),c("label",i.id?"Actualizar":"Guardar")("disabled",i.formData.invalid))},dependencies:[I,k,me,ce,O,se,V,fe,pe,ue,xe,j,W,P,B,N,H,A,Te,De,Fe],encapsulation:2})};var Ge=()=>["nombre","apellido"],ke=()=>["w-16 h-8 rounded-md flex items-center justify-center bg-slate-300"],We=m=>["w-16 h-8 rounded-md flex items-center justify-center",m];function Re(m,r){m&1&&(t(0,"tr")(1,"th",21)(2,"div",22),o(3,"Fecha"),n()(),t(4,"th",21)(5,"div",23),o(6,"Apellidos y Nombre"),n()(),t(7,"th",21)(8,"div",22),o(9,"Edificio"),n()(),t(10,"th",21)(11,"div",22),o(12,"Cargo"),n()(),t(13,"th",24)(14,"div",22),o(15,"Horario"),n()(),t(16,"th",24)(17,"div",22),o(18,"Marcaci\xF3n"),n()(),t(19,"th",21)(20,"div",22),o(21,"Acciones"),n()()(),t(22,"tr")(23,"th")(24,"div",22),o(25,"Entrada"),n()(),t(26,"th")(27,"div",22),o(28,"Salida"),n()(),t(29,"th")(30,"div",22),o(31,"Entrada"),n()(),t(32,"th")(33,"div",22),o(34,"Salida"),n()()())}function qe(m,r){if(m&1){let e=z();t(0,"tr")(1,"td"),o(2),S(3,"date"),S(4,"uppercase"),n(),t(5,"td"),o(6),n(),t(7,"td"),o(8),n(),t(9,"td"),o(10),n(),t(11,"td",25)(12,"div",26)(13,"div",27),o(14),S(15,"date"),n()()(),t(16,"td",25)(17,"div",26)(18,"div",27),o(19),S(20,"date"),n()()(),t(21,"td",25)(22,"div",26)(23,"div",28),o(24),S(25,"date"),S(26,"date"),n()()(),t(27,"td",25)(28,"div",26)(29,"div",28),o(30),S(31,"date"),S(32,"date"),n()()(),t(33,"td")(34,"div",29)(35,"p-button",30),C("click",function(){let d=y(e).$implicit,a=Z();return M(a.editar(d))}),v(36,"i",31),n()()()()}if(m&2){let e=r.$implicit;l(2),E(te(4,19,b(3,16,e.fecha,"dd MMM yyyy"))),l(4),ee("",e.apellido," ",e.nombre,""),l(2),E(e.sede.nombre),l(2),E(e.cargo.nombre),l(3),c("ngClass",h(39,ke)),l(),D(" ",b(15,21,e==null||e.horario==null?null:e.horario.entrada,"HH:mm")," "),l(4),c("ngClass",h(40,ke)),l(),D(" ",b(20,24,e==null||e.horario==null?null:e.horario.salida,"HH:mm")," "),l(4),c("ngClass",Y(41,We,(e.horario==null?null:e.horario.entrada)!=(e.asistencia==null?null:e.asistencia.marcacionEntrada)?e.asistencia!=null&&e.asistencia.correccion?"bg-green-400 text-slate-50":"bg-red-100 border border-red-600 text-red-600":"bg-slate-300"))("pTooltip",(e.horario==null?null:e.horario.entrada)!=(e.asistencia==null?null:e.asistencia.marcacionEntrada)&&(e.asistencia!=null&&e.asistencia.correccion)?"Corregido":""),l(),D(" ",e.asistencia!=null&&e.asistencia.correccion?b(25,27,e.asistencia==null||e.asistencia.correccion==null?null:e.asistencia.correccion.marcacionEntrada,"HH:mm"):e.asistencia!=null&&e.asistencia.marcacionEntrada?b(26,30,e.asistencia==null?null:e.asistencia.marcacionEntrada,"HH:mm"):"--:--"," "),l(5),c("ngClass",Y(43,We,(e.horario==null?null:e.horario.salida)!=(e.asistencia==null?null:e.asistencia.marcacionSalida)?e.asistencia!=null&&e.asistencia.correccion?"bg-green-100 border border-green-600 text-green-600":"bg-red-100 border border-red-600 text-red-600":"bg-slate-300"))("pTooltip",(e.horario==null?null:e.horario.salida)!=(e.asistencia==null?null:e.asistencia.marcacionSalida)&&(e.asistencia!=null&&e.asistencia.correccion)?"Corregido":""),l(),D(" ",e.asistencia!=null&&e.asistencia.correccion?b(31,33,e.asistencia==null||e.asistencia.correccion==null?null:e.asistencia.correccion.marcacionSalida,"HH:mm"):e.asistencia!=null&&e.asistencia.marcacionSalida?b(32,36,e.asistencia==null?null:e.asistencia.marcacionSalida,"HH:mm"):"--:--"," "),l(6),q("data-icon","material-symbols:feature-search-outline-rounded")}}var je=class m{title="Trabajadores con marcaci\xF3n incorrecta";icon="material-symbols:person-pin-outline-rounded";ref;dialogService=p(T);sedeService=p(Ee);cargoService=p(we);asistenciaService=p(Oe);fechaSelected;listaSedes=[];selectedSedes=[];listaCargos=[];selectedCargos=[];dataTable=[];listaAsistenciaMensual=[];ngOnInit(){this.fechaSelected=new Date("2025/04/01"),this.cargarAsistenciaObservada()}cargarAsistenciaObservada(){K([this.sedeService.findAll(),this.cargoService.findAll()]).pipe(J(r=>(this.listaSedes=r[0],this.selectedSedes=this.listaSedes.map(e=>e.id),this.listaCargos=r[1],this.selectedCargos=this.listaCargos.map(e=>e.id),this.asistenciaService.findAllObservadoByMonth(this.fechaSelected)))).subscribe({next:r=>{this.listaAsistenciaMensual=r,this.filtrar()}})}filtrar(r){this.dataTable=this.listaAsistenciaMensual.filter(e=>this.selectedSedes.includes(e.sede.id)&&this.selectedCargos.includes(e.cargo.id))}cambiarFecha(r){this.cargarAsistenciaObservada()}editar(r){this.dialogService.open(G,{header:r.corrected?"Detalle de la correcci\xF3n":"Corregir marcaci\xF3n",data:r,styleClass:"modal-md",focusOnShow:!1,modal:!0,dismissableMask:!0,closable:!0}).onClose.subscribe(i=>{i&&this.cargarAsistenciaObservada()})}filterGlobal(r,e){r.filterGlobal(e.value,"contains")}static \u0275fac=function(e){return new(e||m)};static \u0275cmp=F({type:m,selectors:[["app-correccion-marcacion"]],features:[ie([T])],decls:28,vars:14,consts:[["dt1",""],["header",""],["body",""],[1,"flex","flex-col","h-full"],[1,"flex","flex-col","justify-center","gap-4","px-6","py-4","h-[8.5rem]"],[1,"flex","justify-between","items-center","gap-4"],[1,"flex","items-center","gap-4"],["data-inline","false",1,"iconify","icon","font-bold","text-4xl"],[1,"text-2xl","font-semibold"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],["id","fechaInicio","view","month","dateFormat","MM yy","placeholder","Seleccionar mes","showIcon","","iconDisplay","input","styleClass","w-44","appendTo","body","pTooltip","Mes","tooltipPosition","top","tooltipStyleClass","text-sm",3,"ngModelChange","ngModel","readonlyInput"],["optionLabel","nombre","optionValue","id","placeholder","Edificios","styleClass","w-42","pTooltip","Edificios","tooltipPosition","top","tooltipStyleClass","text-sm",3,"ngModelChange","onChange","options","ngModel","maxSelectedLabels"],["optionLabel","nombre","optionValue","id","placeholder","Cargos","styleClass","w-42","pTooltip","Cargos","tooltipPosition","top","tooltipStyleClass","text-sm",3,"ngModelChange","onChange","options","ngModel","maxSelectedLabels"],["styleClass","pi pi-search"],["type","text","pInputText","","placeholder","Buscar",3,"input"],["severity","info","size","small"],[1,"flex","justify-center","items-center","font-medium","gap-1"],["data-icon","material-symbols:download-rounded","data-inline","false",1,"iconify","icon","text-lg"],[1,"flex","flex-col","h-[calc(100%","-","8.5rem)]","px-6"],["dataKey","id","stripedRows","","scrollHeight","715px","styleClass","w-full",3,"value","scrollable","globalFilterFields"],["rowspan","2"],[1,"text-center","text-xs","uppercase"],[1,"text-xs","uppercase"],["colspan","2"],[1,"!text-center","!text-sm"],[1,"flex","justify-center"],[3,"ngClass"],["tooltipPosition","top","tooltipStyleClass","text-xs",3,"ngClass","pTooltip"],[1,"flex","justify-center","items-center","gap-2"],["text","","severity","info","size","small","rounded","","styleClass","!w-10 !p-2","pTooltip","Corregir","tooltipPosition","top","tooltipStyleClass","!text-xs !font-normal !p-0",3,"click"],["data-inline","false",1,"iconify","icon","font-bold","text-xl"]],template:function(e,i){if(e&1){let d=z();t(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6),v(4,"i",7),t(5,"h2",8),o(6),n()()(),t(7,"div",9)(8,"div",10)(9,"p-datepicker",11),g("ngModelChange",function(s){return y(d),f(i.fechaSelected,s)||(i.fechaSelected=s),M(s)}),C("ngModelChange",function(s){return y(d),M(i.cambiarFecha(s))}),n(),t(10,"p-multiselect",12),g("ngModelChange",function(s){return y(d),f(i.selectedSedes,s)||(i.selectedSedes=s),M(s)}),C("onChange",function(s){return y(d),M(i.filtrar(s.value))}),n(),t(11,"p-multiselect",13),g("ngModelChange",function(s){return y(d),f(i.selectedCargos,s)||(i.selectedCargos=s),M(s)}),C("onChange",function(s){return y(d),M(i.filtrar(s.value))}),n(),t(12,"p-iconfield"),v(13,"p-inputicon",14),t(14,"input",15),C("input",function(s){y(d);let Be=$(23);return M(i.filterGlobal(Be,s.target))}),n()()(),t(15,"div",10)(16,"p-button",16)(17,"div",17),v(18,"i",18),t(19,"div"),o(20,"XLS"),n()()()()()(),t(21,"div",19)(22,"p-table",20,0),Q(24,Re,35,0,"ng-template",null,1,U)(26,qe,37,45,"ng-template",null,2,U),n()()()}e&2&&(l(4),q("data-icon",i.icon),l(2),E(i.title),l(3),u("ngModel",i.fechaSelected),c("readonlyInput",!0),l(),c("options",i.listaSedes),u("ngModel",i.selectedSedes),c("maxSelectedLabels",2),l(),c("options",i.listaCargos),u("ngModel",i.selectedCargos),c("maxSelectedLabels",2),l(11),c("value",i.dataTable)("scrollable",!0)("globalFilterFields",h(13,Ge)))},dependencies:[I,ne,ae,re,k,O,V,_e,ve,N,P,B,Se,Me,j,W,he,ge,Ie,H,A,ye,Ce],encapsulation:2})};export{je as CorreccionMarcacionComponent};
