import{b as Ae}from"./chunk-3UQBCJYR.js";import{b as Le}from"./chunk-ONYTKEPH.js";import{a as Ge}from"./chunk-7BWTKBU3.js";import{a as We,b as Ye}from"./chunk-HSUUTGKP.js";import{a as Oe}from"./chunk-W6ENELZB.js";import{a as Be,b as Re}from"./chunk-AKEGUMGJ.js";import{b as ke}from"./chunk-OXAP3N3H.js";import{b as He}from"./chunk-RVQOAWJC.js";import{a as z}from"./chunk-TVRGOZ6Z.js";import{a as H}from"./chunk-LGAXEAXJ.js";import{a as $}from"./chunk-ZGEBOACG.js";import{a as Ve,b as Ne}from"./chunk-KOIAJ6TH.js";import"./chunk-G453X5NG.js";import{d as R,e as W,l as Ie,n as je}from"./chunk-CWKDICKV.js";import{c as Pe,d as Fe,h as Ee,i as Y}from"./chunk-NYQZODR7.js";import{c as De,d as M}from"./chunk-BBS5CLCL.js";import{b as he,c as C,e as N,f as be,g as ve,i as v,j as Ce,k as _e,l as Se,o as ye,r as k,s as xe,t as Te,u as A}from"./chunk-7W2NGOAN.js";import"./chunk-FNTIPBS5.js";import"./chunk-A3HZ2PBM.js";import"./chunk-2BOM3PMI.js";import{b as we,d as Me,f as L,g as B}from"./chunk-RVXUJXBG.js";import{a as ge}from"./chunk-Q2HHWBKA.js";import"./chunk-4Q3JVAKG.js";import{b as ue}from"./chunk-MCE4IIOZ.js";import{Ea as G,Fa as O}from"./chunk-F2X7M4DW.js";import"./chunk-WCGJ44IN.js";import{B as V,m as me,o as de,p as pe,v as ce,w as fe}from"./chunk-J6775IRK.js";import{$ as d,$b as x,Cb as re,Eb as oe,Fb as ae,Gb as i,Hb as r,Ib as g,Jb as ne,Kb as le,Mb as y,Rb as h,Sb as E,Ta as n,V as te,ac as l,bc as U,cc as b,ec as I,fa as c,fc as j,ga as f,gc as D,hb as F,hc as se,ic as J,jc as K,nb as S,r as q,sc as T,tc as X,uc as Q,vb as ie,wb as m,wc as w}from"./chunk-VDH5VFWZ.js";import{a as Z,b as ee}from"./chunk-EQDQRRRY.js";var _=class a{url=`${ge.apiUrl}/permisosTrabajador`;http=d(ue);findAll(){return this.http.get(this.url)}findOne(t){return this.http.get(`${this.url}/${t}`)}create(t){let e=Ge(t);return this.http.post(`${this.url}`,e)}update(t,e){return this.http.put(`${this.url}/${t}`,e)}static \u0275fac=function(e){return new(e||a)};static \u0275prov=te({token:a,factory:a.\u0275fac,providedIn:"root"})};var P=class a{ref=d(De);dialogService=d(M);msg=d(Oe);cargoService=d(H);sedeService=d(z);trabajadorService=d($);permisoService=d(_);listaTrabajadores=[];listaTrabajadoresFiltrados=[];listaSedes=[];listaCargos=[];formData=new ve({idSede:new v(void 0,{nonNullable:!0,validators:[C.required]}),idCargo:new v(void 0,{nonNullable:!0,validators:[C.required]}),idTrabajador:new v(void 0,{nonNullable:!0,validators:[C.required]}),fechaInicio:new v(void 0,{nonNullable:!0,validators:[C.required]}),fechaFin:new v(void 0,{nonNullable:!0,validators:[C.required]}),nota:new v(void 0,{nonNullable:!0,validators:[]}),conGoce:new v(!1,{nonNullable:!0,validators:[]}),incluirExtra:new v({value:!1,disabled:!0},{nonNullable:!0,validators:[]})});id;archivo;filename;ngOnInit(){let t=this.dialogService.getInstance(this.ref);t.data&&(this.id=t.data.id,this.formData.controls.idSede.setValue(t.data.idSede),this.formData.controls.idCargo.setValue(t.data.idCargo),this.formData.controls.idTrabajador.setValue(t.data.idTrabajador),this.formData.controls.fechaInicio.setValue(new Date(t.data.fechaInicio)),this.formData.controls.fechaFin.setValue(new Date(t.data.fechaFin)),this.formData.controls.nota.setValue(t.data.nota)),this.cargarSedes(),this.cargarCargos(),this.cargarTrabajadoresActivos()}cargarSedes(){this.sedeService.findAll().subscribe({next:t=>{this.listaSedes=t}})}cargarCargos(){this.cargoService.findAll().subscribe({next:t=>{this.listaCargos=t}})}cargarTrabajadoresActivos(){this.trabajadorService.findAllActivos().subscribe({next:t=>{this.listaTrabajadores=t.map(e=>(e.labelName=`${e.identificacion} | ${e.apellido} ${e.nombre}`,e)),this.filtrar(null)}})}filtrar(t){this.listaTrabajadoresFiltrados=this.listaTrabajadores.filter(e=>e.asignacionSedes[0]?.idSede===this.formData.get("idSede")?.value&&e.contratos[0].idCargo===this.formData.get("idCargo")?.value)}get conGoce(){return!!this.formData.get("conGoce")?.value}onFileSelected(t){let e=t.target.files[0];e&&e.type==="application/pdf"?(this.msg.info("Archivo cargado"),this.archivo=e,this.filename=this.archivo.name):(this.msg.error("Archivo inv\xE1lido. Solo se permiten archivos PDF."),t.target.value="",this.archivo=void 0,this.filename="")}guardar(){let t=this.formData.value;this.id?this.permisoService.update(this.id,t).subscribe({next:e=>{this.msg.success("\xA1Actualizado con \xE9xito!"),this.ref.close(e)},error:e=>{this.msg.error(e.error.message)}}):this.permisoService.create(ee(Z({},t),{archivo:this.archivo})).subscribe({next:e=>{this.msg.success("\xA1Registrado con \xE9xito!"),this.ref.close(e)},error:e=>{this.msg.error(e.error.message)}})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=F({type:a,selectors:[["app-form-permiso"]],decls:49,vars:11,consts:[["fileImage",""],[1,"flex","flex-col","gap-2"],[1,"grid","grid-cols-1","gap-2",3,"formGroup"],["for","idSede",1,"text-sm","font-medium"],["id","idSede","optionLabel","nombre","optionValue","id","formControlName","idSede","placeholder","Seleccione...",3,"onChange","options"],["for","idCargo",1,"text-sm","font-medium"],["id","idCargo","optionLabel","nombre","optionValue","id","formControlName","idCargo","placeholder","Seleccione...",3,"onChange","options"],["for","idTrabajador",1,"text-sm","font-medium"],["id","idTrabajador","optionLabel","labelName","optionValue","id","formControlName","idTrabajador","placeholder","Seleccione...",3,"options"],["for","fechaInicio",1,"text-sm","font-medium"],["id","fechaInicio","styleClass","w-full uppercase","dateFormat","dd M yy","placeholder","DD MMM YYYY","formControlName","fechaInicio","appendTo","body",3,"showIcon"],["for","fechaFin",1,"text-sm","font-medium"],["id","fechaFin","styleClass","w-full uppercase","dateFormat","dd M yy","placeholder","DD MMM YYYY","formControlName","fechaFin","appendTo","body",3,"showIcon"],["for","nota",1,"text-sm","font-medium"],["id","nota","rows","3","cols","30","pTextarea","","formControlName","nota"],["for","username",1,"text-sm","font-medium"],[1,"flex"],["type","file","accept","application/pdf",1,"hidden",3,"change"],[1,"flex","items-center","gap-2"],["severity","contrast","size","small",3,"click"],[1,"flex","justify-center","items-center"],[1,"w-64","text-sm","italic","truncate",3,"pTooltip"],["formControlName","conGoce","binary","true"],["for","conGoce",1,"text-sm","pt-1"],["formControlName","incluirExtra","binary","true",3,"disabled"],["for","incluirExtra",1,"text-sm","pt-1"],[1,"flex","justify-end","gap-2","mt-4"],["severity","info","size","small",3,"onClick","label","disabled"]],template:function(e,o){if(e&1){let p=y();i(0,"div",1)(1,"form",2)(2,"div",1)(3,"label",3),l(4,"Edificio"),r(),i(5,"p-select",4),h("onChange",function(s){return c(p),f(o.filtrar(s))}),r()(),i(6,"div",1)(7,"label",5),l(8,"Cargo"),r(),i(9,"p-select",6),h("onChange",function(s){return c(p),f(o.filtrar(s))}),r()(),i(10,"div",1)(11,"label",7),l(12,"Trabajador"),r(),g(13,"p-select",8),r(),i(14,"div",1)(15,"label",9),l(16,"Fecha de inicio"),r(),g(17,"p-datepicker",10),r(),i(18,"div",1)(19,"label",11),l(20,"Fecha de fin"),r(),g(21,"p-datepicker",12),r(),i(22,"div",1)(23,"label",13),l(24,"Nota"),r(),g(25,"textarea",14),r(),i(26,"div",1)(27,"label",15),l(28,"Archivo adjunto "),r(),i(29,"div",16)(30,"input",17,0),h("change",function(s){return c(p),f(o.onFileSelected(s))}),r(),i(32,"div",18)(33,"p-button",19),h("click",function(){c(p);let s=x(31);return f(s.click())}),i(34,"div",20)(35,"div"),l(36,"Cargar"),r()()(),i(37,"p",21),l(38),r()()()(),i(39,"div",18),g(40,"p-checkbox",22),i(41,"label",23),l(42," Justificaci\xF3n con goce de haber "),r()(),i(43,"div",18),g(44,"p-checkbox",24),i(45,"label",25),l(46," Incluir pago de horas extra "),r()()(),i(47,"div",26)(48,"p-button",27),h("onClick",function(){return c(p),f(o.guardar())}),r()()()}e&2&&(n(),m("formGroup",o.formData),n(4),m("options",o.listaSedes),n(4),m("options",o.listaCargos),n(4),m("options",o.listaTrabajadoresFiltrados),n(4),m("showIcon",!0),n(4),m("showIcon",!0),n(16),m("pTooltip",o.filename),n(),b(" ",o.filename?o.filename:"Archivo no cargado."," "),n(6),m("disabled",!o.conGoce),n(4),m("label",o.id?"Actualizar":"Guardar")("disabled",o.formData.invalid||!o.archivo))},dependencies:[V,k,_e,he,N,be,xe,Se,ye,ke,A,O,G,Y,Ee,W,R,Re,Be,Ae,Fe,Pe,B,L,Le],encapsulation:2})};var Ze=()=>["nombre","apellido"],et=a=>[a],tt=a=>["text-xs uppercase",a],it=()=>[];function rt(a,t){if(a&1&&(i(0,"th",26)(1,"div",26),l(2),r()()),a&2){let e=t.$implicit;m("ngClass",K(3,et,e.widthClass?e.widthClass:"")),n(),m("ngClass",K(5,tt,e.align?"text-"+e.align:"text-start")),n(),b(" ",e.header," ")}}function ot(a,t){if(a&1&&(i(0,"tr"),S(1,rt,3,7,"th",25),r()),a&2){let e=t.$implicit;n(),m("ngForOf",e)}}function at(a,t){if(a&1){let e=y();i(0,"tr",27),h("click",function(){let p=c(e).$implicit,u=E();return f(u.edit(p))}),i(1,"td")(2,"div",28),l(3),r()(),i(4,"td")(5,"div",28),l(6),r()(),i(7,"td")(8,"div",29),l(9),r()(),i(10,"td")(11,"div",29),l(12),r()(),i(13,"td")(14,"div",28),l(15),r()(),i(16,"td")(17,"div",28),l(18),r()(),i(19,"td")(20,"div",28),l(21),T(22,"date"),T(23,"uppercase"),r()(),i(24,"td")(25,"div",28),l(26),T(27,"date"),T(28,"uppercase"),r()()()}if(a&2){let e=t.$implicit;n(3),b(" ",e.orden," "),n(3),b(" ",e.sede.nombre," "),n(3),U(e.trabajador==null?null:e.trabajador.nombre),n(3),b(" ",e.trabajador==null?null:e.trabajador.apellido," "),n(3),b(" ",e.cargo.nombre," "),n(3),b(" ",e.nota," "),n(3),b(" ",X(23,11,Q(22,8,e.fechaInicio,"dd MMM yyyy"))," "),n(5),b(" ",X(28,16,Q(27,13,e.fechaFin,"dd MMM yyyy"))," ")}}function nt(a,t){a&1&&(i(0,"td"),g(1,"p-skeleton"),r())}function lt(a,t){if(a&1&&(i(0,"tr",31),S(1,nt,2,0,"td",32),r()),a&2){let e=E(3);n(),m("ngForOf",e.cols)}}function st(a,t){a&1&&(ne(0),oe(1,lt,2,1,"tr",31,re),le()),a&2&&(n(),ae(J(0,it).constructor(4)))}function mt(a,t){a&1&&(i(0,"tr")(1,"td",33)(2,"div",34),l(3," No se encontraron registros. "),r()()())}function dt(a,t){if(a&1&&S(0,st,3,1,"ng-container",30)(1,mt,4,0,"ng-template",null,4,w),a&2){let e=x(2),o=E();m("ngIf",o.loadingTable)("ngIfElse",e)}}var ze=class a{title="Permisos";icon="material-symbols:person-pin-outline-rounded";dialogService=d(M);sedeService=d(z);cargoService=d(H);trabajadorService=d($);permisoService=d(_);fechaSelected=new Date("2025/03/01");listaSedes=[];selectedSedes=[];listaCargos=[];selectedCargos=[];listaPermisos=[];dataTable=[];cols;exportColumns;loadingTable=!1;ngOnInit(){this.cols=[{field:"id",header:"ID",customExportHeader:"Permiso ID",align:"center",widthClass:"!w-20"},{field:"sede",header:"Sede",align:"center"},{field:"nombre",header:"Nombre"},{field:"apellido",header:"Apellido"},{field:"cargo",header:"Cargo",align:"center"},{field:"nota",header:"Nota",align:"center"},{field:"fechaInicio",header:"Fecha inicio",align:"center"},{field:"fechaFin",header:"Fecha fin",align:"center"}],this.exportColumns=this.cols.map(t=>({title:t.header,dataKey:t.field})),this.cargarPermisos()}cargarPermisos(){this.loadingTable=!0,this.cargoService.findAll().pipe(q(t=>(this.listaCargos=t,this.selectedCargos=this.listaCargos.map(e=>e.id),this.sedeService.findAll())),q(t=>(this.listaSedes=t,this.selectedSedes=this.listaSedes.map(e=>e.id),this.permisoService.findAll()))).subscribe({next:t=>{this.loadingTable=!1,this.listaPermisos=t,this.filtrar()}})}filtrar(t){this.dataTable=this.listaPermisos.filter(e=>this.selectedSedes.includes(e.idSede)&&this.selectedCargos.includes(e.idCargo))}addNew(){this.dialogService.open(P,{header:"Nuevo permiso",styleClass:"modal-md",modal:!0,dismissableMask:!0,closable:!0}).onClose.subscribe(e=>{e&&this.cargarPermisos()})}edit(t){this.dialogService.open(P,{header:"Modificar permiso",styleClass:"modal-md",position:"top",data:t,modal:!0,dismissableMask:!0,closable:!0}).onClose.subscribe(o=>{o&&this.cargarPermisos()})}filterGlobal(t,e){t.filterGlobal(e.value,"contains")}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=F({type:a,selectors:[["app-permisos"]],features:[se([M])],decls:35,vars:16,consts:[["dt1",""],["header",""],["body",""],["emptymessage",""],["elseTemplate",""],[1,"flex","flex-col","h-full"],[1,"flex","flex-col","justify-center","gap-4","px-6","py-4","h-[8.5rem]"],[1,"flex","justify-between","items-center","gap-4"],[1,"flex","items-center","gap-4"],["data-inline","false",1,"iconify","icon","font-bold","text-4xl"],[1,"text-2xl","font-semibold"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],["id","fechaInicio","view","month","dateFormat","MM yy","placeholder","Seleccionar mes","showIcon","","iconDisplay","input","styleClass","w-44","appendTo","body","pTooltip","Mes","tooltipPosition","top","tooltipStyleClass","text-sm",3,"ngModelChange","ngModel","readonlyInput"],["optionLabel","nombre","optionValue","id","placeholder","Edificios","styleClass","w-42","pTooltip","Edificios","tooltipPosition","top","tooltipStyleClass","text-sm",3,"ngModelChange","onChange","options","ngModel","maxSelectedLabels"],["optionLabel","nombre","optionValue","id","placeholder","Cargos","styleClass","w-42","pTooltip","Cargos","tooltipPosition","top","tooltipStyleClass","text-sm",3,"ngModelChange","onChange","options","ngModel","maxSelectedLabels"],["styleClass","pi pi-search"],["type","text","pInputText","","placeholder","Buscar",3,"input"],["severity","info","size","small"],[1,"flex","justify-center","items-center","font-medium","gap-1"],["data-icon","material-symbols:download-rounded","data-inline","false",1,"iconify","icon","text-lg"],["severity","info","size","small",3,"click"],["data-icon","material-symbols:add-rounded","data-inline","false",1,"iconify","icon","text-lg"],[1,"flex","flex-col","h-[calc(100%","-","8.5rem)]","px-6"],["stripedRows","","scrollHeight","720px","styleClass","w-full","exportFilename","permisos",3,"columns","value","scrollable","exportHeader","globalFilterFields"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"hover:!bg-slate-200","cursor-pointer",3,"click"],[1,"text-center","text-sm"],[1,"text-start","text-sm"],[4,"ngIf","ngIfElse"],[1,"h-12"],[4,"ngFor","ngForOf"],["colspan","100"],[1,"text-center","text-sm","font-extralight"]],template:function(e,o){if(e&1){let p=y();i(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8),g(4,"i",9),i(5,"h2",10),l(6),r()()(),i(7,"div",11)(8,"div",12)(9,"p-datepicker",13),D("ngModelChange",function(s){return c(p),j(o.fechaSelected,s)||(o.fechaSelected=s),f(s)}),r(),i(10,"p-multiselect",14),D("ngModelChange",function(s){return c(p),j(o.selectedSedes,s)||(o.selectedSedes=s),f(s)}),h("onChange",function(s){return c(p),f(o.filtrar(s.value))}),r(),i(11,"p-multiselect",15),D("ngModelChange",function(s){return c(p),j(o.selectedCargos,s)||(o.selectedCargos=s),f(s)}),h("onChange",function(s){return c(p),f(o.filtrar(s.value))}),r(),i(12,"p-iconfield"),g(13,"p-inputicon",16),i(14,"input",17),h("input",function(s){c(p);let qe=x(28);return f(o.filterGlobal(qe,s.target))}),r()()(),i(15,"div",12)(16,"p-button",18)(17,"div",19),g(18,"i",20),i(19,"div"),l(20,"XLS"),r()()(),i(21,"p-button",21),h("click",function(){return c(p),f(o.addNew())}),i(22,"div",19),g(23,"i",22),i(24,"div"),l(25,"AGREGAR"),r()()()()()(),i(26,"div",23)(27,"p-table",24,0),S(29,ot,2,1,"ng-template",null,1,w)(31,at,29,18,"ng-template",null,2,w)(33,dt,3,2,"ng-template",null,3,w),r()()()}e&2&&(n(4),ie("data-icon",o.icon),n(2),U(o.title),n(3),I("ngModel",o.fechaSelected),m("readonlyInput",!0),n(),m("options",o.listaSedes),I("ngModel",o.selectedSedes),m("maxSelectedLabels",2),n(),m("options",o.listaCargos),I("ngModel",o.selectedCargos),m("maxSelectedLabels",2),n(16),m("columns",o.cols)("value",o.dataTable)("scrollable",!0)("exportHeader","customExportHeader")("globalFilterFields",J(15,Ze)))},dependencies:[V,me,de,pe,ce,fe,k,N,Ce,O,G,je,Ie,Me,we,A,Te,Y,He,W,R,B,L,Ne,Ve,Ye,We],encapsulation:2})};export{ze as PermisosComponent};
